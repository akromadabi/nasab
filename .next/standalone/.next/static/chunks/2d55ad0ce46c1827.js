(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,62645,e=>{"use strict";var s=e.i(43476),a=e.i(71645),t=e.i(54212),r=e.i(20354),l=e.i(98361),i=e.i(75254);let n=(0,i.default)("minimize-2",[["path",{d:"m14 10 7-7",key:"oa77jy"}],["path",{d:"M20 10h-6V4",key:"mjg0md"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M4 14h6v6",key:"rmj7iw"}]]);var c=e.i(43432),d=e.i(84614),o=e.i(64659),x=e.i(55900),m=e.i(78917),u=e.i(55436),h=e.i(7233),p=e.i(19170),f=e.i(90597),b=e.i(61911),g=e.i(31278),j=e.i(37727),N=e.i(63059),y=e.i(73375),v=e.i(5004),k=e.i(70956);let w=(0,i.default)("map-pin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]),C=(0,i.default)("calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]),A=(0,i.default)("square-pen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);var S=e.i(27612),L=e.i(39616);let M=(0,i.default)("globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);var E=e.i(70756);let P=(0,i.default)("copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),T=(0,i.default)("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]),$=(0,i.default)("arrow-down-up",[["path",{d:"m3 16 4 4 4-4",key:"1co6wj"}],["path",{d:"M7 20V4",key:"1yoxec"}],["path",{d:"m21 8-4-4-4 4",key:"1c9v7m"}],["path",{d:"M17 4v16",key:"7dpous"}]]);var I=e.i(26707);let W=(0,i.default)("calendar-days",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]]);var O=e.i(75157),z=e.i(17989);let R=[{key:"instagram",label:"Instagram",placeholder:"@username",color:"text-pink-600",bg:"bg-pink-50"},{key:"facebook",label:"Facebook",placeholder:"Nama atau URL",color:"text-blue-600",bg:"bg-blue-50"},{key:"tiktok",label:"TikTok",placeholder:"@username",color:"text-surface-900",bg:"bg-surface-100"},{key:"twitter",label:"Twitter / X",placeholder:"@username",color:"text-sky-500",bg:"bg-sky-50"},{key:"youtube",label:"YouTube",placeholder:"Channel URL",color:"text-red-600",bg:"bg-red-50"},{key:"linkedin",label:"LinkedIn",placeholder:"URL profil",color:"text-blue-700",bg:"bg-blue-50"}];function D(e,s){let a=s.trim();if(a.startsWith("http://")||a.startsWith("https://"))return a;let t=a.replace(/^@/,"");switch(e){case"instagram":return`https://instagram.com/${t}`;case"facebook":return`https://facebook.com/${t}`;case"tiktok":return`https://tiktok.com/@${t}`;case"twitter":return`https://x.com/${t}`;case"youtube":return`https://youtube.com/${t.startsWith("@")?t:"@"+t}`;case"linkedin":return`https://linkedin.com/in/${t}`;default:return"#"}}function H({platform:e,className:a="w-4 h-4"}){switch(e){case"instagram":return(0,s.jsx)("svg",{className:a,viewBox:"0 0 24 24",fill:"currentColor",children:(0,s.jsx)("path",{d:"M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zM12 0C8.741 0 8.333.014 7.053.072 2.695.272.273 2.69.073 7.052.014 8.333 0 8.741 0 12c0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98C8.333 23.986 8.741 24 12 24c3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98C15.668.014 15.259 0 12 0zm0 5.838a6.162 6.162 0 100 12.324 6.162 6.162 0 000-12.324zM12 16a4 4 0 110-8 4 4 0 010 8zm6.406-11.845a1.44 1.44 0 100 2.881 1.44 1.44 0 000-2.881z"})});case"facebook":return(0,s.jsx)("svg",{className:a,viewBox:"0 0 24 24",fill:"currentColor",children:(0,s.jsx)("path",{d:"M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"})});case"tiktok":return(0,s.jsx)("svg",{className:a,viewBox:"0 0 24 24",fill:"currentColor",children:(0,s.jsx)("path",{d:"M12.525.02c1.31-.02 2.61-.01 3.91-.02.08 1.53.63 3.09 1.75 4.17 1.12 1.11 2.7 1.62 4.24 1.79v4.03c-1.44-.05-2.89-.35-4.2-.97-.57-.26-1.1-.59-1.62-.93-.01 2.92.01 5.84-.02 8.75-.08 1.4-.54 2.79-1.35 3.94-1.31 1.92-3.58 3.17-5.91 3.21-1.43.08-2.86-.31-4.08-1.03-2.02-1.19-3.44-3.37-3.65-5.71-.02-.5-.03-1-.01-1.49.18-1.9 1.12-3.72 2.58-4.96 1.66-1.44 3.98-2.13 6.15-1.72.02 1.48-.04 2.96-.04 4.44-.99-.32-2.15-.23-3.02.37-.63.41-1.11 1.04-1.36 1.75-.21.51-.15 1.07-.14 1.61.24 1.64 1.82 3.02 3.5 2.87 1.12-.01 2.19-.66 2.77-1.61.19-.33.4-.67.41-1.06.1-1.79.06-3.57.07-5.36.01-4.03-.01-8.05.02-12.07z"})});case"twitter":return(0,s.jsx)("svg",{className:a,viewBox:"0 0 24 24",fill:"currentColor",children:(0,s.jsx)("path",{d:"M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"})});case"youtube":return(0,s.jsx)("svg",{className:a,viewBox:"0 0 24 24",fill:"currentColor",children:(0,s.jsx)("path",{d:"M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"})});case"linkedin":return(0,s.jsx)("svg",{className:a,viewBox:"0 0 24 24",fill:"currentColor",children:(0,s.jsx)("path",{d:"M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"})});default:return(0,s.jsx)(m.ExternalLink,{className:a})}}function F({entries:e,onChange:t,inputClass:r,labelClass:l}){let[i,n]=(0,a.useState)(!1),c=e.map(e=>e.key),d=R.filter(e=>!c.includes(e.key));return(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:l,children:"Sosial Media"}),e.map((a,l)=>{let i=R.find(e=>e.key===a.key);return(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:`w-8 h-8 rounded-lg ${i?.bg||"bg-surface-100"} ${i?.color||"text-surface-500"} flex items-center justify-center flex-shrink-0`,children:(0,s.jsx)(H,{platform:a.key,className:"w-4 h-4"})}),(0,s.jsx)("input",{type:"text",value:a.value,onChange:s=>{var a;let r;return a=s.target.value,void((r=[...e])[l]={...r[l],value:a},t(r))},className:`${r} flex-1`,placeholder:i?.placeholder||""}),(0,s.jsx)("button",{type:"button",onClick:()=>{t(e.filter((e,s)=>s!==l))},className:"w-8 h-8 rounded-lg border border-surface-200 text-surface-400 flex items-center justify-center hover:bg-red-50 hover:text-red-500 hover:border-red-200 transition-colors flex-shrink-0",children:(0,s.jsx)(j.X,{className:"w-3.5 h-3.5"})})]},a.key)}),d.length>0&&(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsxs)("button",{type:"button",onClick:()=>n(!i),className:"inline-flex items-center gap-1.5 px-3 py-1.5 rounded-lg border border-dashed border-surface-300 text-xs text-surface-500 font-medium hover:border-primary-400 hover:text-primary-600 transition-colors",children:[(0,s.jsx)(h.Plus,{className:"w-3.5 h-3.5"}),"Tambah Sosial Media"]}),i&&(0,s.jsx)("div",{className:"absolute left-0 top-full mt-1 w-56 bg-white rounded-xl border border-surface-200 shadow-xl z-20 p-1 animate-scale-in",children:d.map(a=>(0,s.jsxs)("button",{type:"button",onClick:()=>{t([...e,{key:a.key,value:""}]),n(!1)},className:"w-full flex items-center gap-2.5 px-3 py-2 rounded-lg hover:bg-surface-50 transition-colors text-left",children:[(0,s.jsx)("div",{className:`w-7 h-7 rounded-md ${a.bg} ${a.color} flex items-center justify-center`,children:(0,s.jsx)(H,{platform:a.key,className:"w-3.5 h-3.5"})}),(0,s.jsx)("span",{className:"text-sm text-surface-700 font-medium",children:a.label})]},a.key))})]})]})}function B({node:e,onSelect:a,onClose:t}){return(0,s.jsxs)("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",onClick:t,children:[(0,s.jsx)("div",{className:"absolute inset-0 bg-black/40 backdrop-blur-sm"}),(0,s.jsxs)("div",{className:"relative w-full max-w-xs bg-white rounded-2xl shadow-2xl animate-scale-in overflow-hidden",onClick:e=>e.stopPropagation(),children:[(0,s.jsxs)("div",{className:"px-4 pt-4 pb-3 border-b border-surface-100",children:[(0,s.jsx)("p",{className:"text-xs text-surface-400 font-medium",children:"Tambah keluarga untuk"}),(0,s.jsx)("p",{className:"text-sm font-semibold text-surface-900 truncate",children:e.fullName})]}),(0,s.jsxs)("div",{className:"p-2",children:[(0,s.jsxs)("button",{onClick:()=>a("child"),className:"w-full flex items-center gap-3 px-3 py-3 rounded-xl hover:bg-primary-50 transition-colors",children:[(0,s.jsx)("div",{className:"w-9 h-9 rounded-lg bg-primary-100 flex items-center justify-center",children:(0,s.jsx)(p.Baby,{className:"w-4.5 h-4.5 text-primary-600"})}),(0,s.jsxs)("div",{className:"text-left",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-surface-800",children:"Tambah Anak"}),(0,s.jsx)("p",{className:"text-[11px] text-surface-400",children:"Anak kandung"})]})]}),(0,s.jsxs)("button",{onClick:()=>a("spouse"),className:"w-full flex items-center gap-3 px-3 py-3 rounded-xl hover:bg-pink-50 transition-colors",children:[(0,s.jsx)("div",{className:"w-9 h-9 rounded-lg bg-pink-100 flex items-center justify-center",children:(0,s.jsx)(f.Heart,{className:"w-4.5 h-4.5 text-pink-600"})}),(0,s.jsxs)("div",{className:"text-left",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-surface-800",children:"Tambah Pasangan"}),(0,s.jsx)("p",{className:"text-[11px] text-surface-400",children:"Suami / Istri"})]})]}),(0,s.jsxs)("button",{onClick:()=>a("sibling"),className:"w-full flex items-center gap-3 px-3 py-3 rounded-xl hover:bg-blue-50 transition-colors",children:[(0,s.jsx)("div",{className:"w-9 h-9 rounded-lg bg-blue-100 flex items-center justify-center",children:(0,s.jsx)(b.Users,{className:"w-4.5 h-4.5 text-blue-600"})}),(0,s.jsxs)("div",{className:"text-left",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-surface-800",children:"Tambah Saudara"}),(0,s.jsx)("p",{className:"text-[11px] text-surface-400",children:"Saudara kandung"})]})]})]}),(0,s.jsx)("div",{className:"px-2 pb-2",children:(0,s.jsx)("button",{onClick:t,className:"w-full py-2.5 rounded-xl text-sm font-medium text-surface-400 hover:bg-surface-50 transition-colors",children:"Batal"})})]})]})}function V({context:e,allMembers:t,baniId:r,onClose:l,onSuccess:i}){let[n,c]=(0,a.useState)(""),[d,o]=(0,a.useState)(""),[x,m]=(0,a.useState)("MALE"),[u,p]=(0,a.useState)(!0),[f,b]=(0,a.useState)(!1),[N,y]=(0,a.useState)(""),[v,k]=(0,a.useState)(""),{type:w,member:C}=e,A=[];"MALE"===C.gender&&C.marriagesAsHusband?C.marriagesAsHusband.forEach(e=>A.push(e.wife)):"FEMALE"===C.gender&&C.marriagesAsWife&&C.marriagesAsWife.forEach(e=>A.push(e.husband));let S=1===A.length,L=A.length>1;(0,a.useEffect)(()=>{"child"===w&&S&&k(A[0].id)},[w,S]);let M="child"===w?`Tambah Anak ${C.fullName}`:"spouse"===w?`Tambah Pasangan ${C.fullName}`:`Tambah Saudara ${C.fullName}`,E="child"===w?"Anggota baru akan menjadi anak dari orang ini":"spouse"===w?"Anggota baru akan menjadi pasangan orang ini":"Anggota baru akan memiliki orang tua yang sama";(0,a.useEffect)(()=>{"spouse"===w&&m("MALE"===C.gender?"FEMALE":"MALE")},[w,C.gender]);let P="child"===w?A.length>0?A.map(e=>({id:e.id,fullName:e.fullName,gender:e.gender,generation:0})):"MALE"===C.gender?t.filter(e=>"FEMALE"===e.gender):t.filter(e=>"MALE"===e.gender):[],T=async e=>{if(e.preventDefault(),n.trim()){b(!0),y("");try{let e,s;"child"===w?"MALE"===C.gender?(e=C.id,s=v||void 0):(s=C.id,e=v||void 0):"sibling"===w&&(e=C.fatherId||void 0,s=C.motherId||void 0);let a=await fetch("/api/members",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({baniId:r,fullName:n.trim(),nickname:d.trim()||void 0,gender:x,isAlive:u,fatherId:e,motherId:s})}),t=await a.json();if(!a.ok)return void y(t.error||"Gagal menyimpan");if("spouse"===w){let e="MALE"===C.gender?C.id:t.id,s="FEMALE"===C.gender?C.id:t.id;(await fetch("/api/marriages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({husbandId:e,wifeId:s})})).ok||console.error("Failed to create marriage, but member was created")}i()}catch{y("Terjadi kesalahan. Silakan coba lagi.")}finally{b(!1)}}};return(0,s.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[(0,s.jsx)("div",{className:"absolute inset-0 bg-black/40 backdrop-blur-sm",onClick:l}),(0,s.jsxs)("div",{className:"relative bg-white rounded-2xl shadow-2xl w-full max-w-md max-h-[90vh] overflow-y-auto animate-scale-in",children:[(0,s.jsxs)("div",{className:"sticky top-0 bg-white rounded-t-2xl border-b border-surface-100 p-5 flex items-start justify-between z-10",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-lg font-bold text-surface-900",children:M}),(0,s.jsx)("p",{className:"text-xs text-surface-400 mt-0.5",children:E})]}),(0,s.jsx)("button",{onClick:l,className:"p-1.5 rounded-lg hover:bg-surface-100 transition-colors text-surface-400",children:(0,s.jsx)(j.X,{className:"w-5 h-5"})})]}),(0,s.jsxs)("form",{onSubmit:T,className:"p-5 space-y-4",children:[N&&(0,s.jsx)("div",{className:"p-3 rounded-xl bg-red-50 border border-red-200 text-red-700 text-sm",children:N}),"child"===w&&(0,s.jsx)("div",{className:"p-3 rounded-xl bg-primary-50 border border-primary-100",children:(0,s.jsxs)("p",{className:"text-xs font-medium text-primary-700",children:["MALE"===C.gender?"ğŸ‘¨ Ayah":"ğŸ‘© Ibu",":"," ",(0,s.jsx)("span",{className:"font-bold",children:C.fullName})]})}),"sibling"===w&&(C.fatherId||C.motherId)&&(0,s.jsxs)("div",{className:"p-3 rounded-xl bg-blue-50 border border-blue-100 space-y-1",children:[(0,s.jsxs)("p",{className:"text-xs text-blue-600",children:["Orang tua yang sama dengan ",C.fullName,":"]}),C.fatherId&&(0,s.jsxs)("p",{className:"text-xs font-medium text-blue-700",children:["ğŸ‘¨ Ayah: ",t.find(e=>e.id===C.fatherId)?.fullName||"â€”"]}),C.motherId&&(0,s.jsxs)("p",{className:"text-xs font-medium text-blue-700",children:["ğŸ‘© Ibu: ",t.find(e=>e.id===C.motherId)?.fullName||"â€”"]})]}),"spouse"===w&&(0,s.jsx)("div",{className:"p-3 rounded-xl bg-pink-50 border border-pink-100",children:(0,s.jsxs)("p",{className:"text-xs font-medium text-pink-700",children:["ğŸ’‘ Pasangan dari ",(0,s.jsx)("span",{className:"font-bold",children:C.fullName})]})}),"child"===w&&S&&(0,s.jsx)("div",{className:"p-3 rounded-xl bg-primary-50 border border-primary-100",children:(0,s.jsxs)("p",{className:"text-xs font-medium text-primary-700",children:["MALE"===C.gender?"ğŸ‘© Ibu":"ğŸ‘¨ Ayah",":"," ",(0,s.jsx)("span",{className:"font-bold",children:A[0].fullName})]})}),"child"===w&&L&&(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-surface-700 mb-1.5",children:"MALE"===C.gender?"Ibu":"Ayah"}),(0,s.jsxs)("select",{value:v,onChange:e=>k(e.target.value),className:"w-full px-3 py-2.5 rounded-xl border border-surface-200 text-sm text-surface-900 focus:outline-none focus:border-primary-500 bg-white",children:[(0,s.jsxs)("option",{value:"",children:["â€” Pilih ","MALE"===C.gender?"Ibu":"Ayah"," â€”"]}),P.map(e=>(0,s.jsx)("option",{value:e.id,children:e.fullName},e.id))]})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-surface-700 mb-1.5",children:["Nama Lengkap ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsx)("input",{type:"text",value:n,onChange:e=>c(e.target.value),className:"w-full px-3 py-2.5 rounded-xl border border-surface-200 text-sm text-surface-900 placeholder-surface-400 focus:outline-none focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 bg-white",placeholder:"Nama lengkap",autoFocus:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-surface-700 mb-1.5",children:"Nama Panggilan"}),(0,s.jsx)("input",{type:"text",value:d,onChange:e=>o(e.target.value),className:"w-full px-3 py-2.5 rounded-xl border border-surface-200 text-sm text-surface-900 placeholder-surface-400 focus:outline-none focus:border-primary-500 bg-white",placeholder:"Panggilan sehari-hari"})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-surface-700 mb-1.5",children:["Jenis Kelamin ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,s.jsx)("button",{type:"button",onClick:()=>m("MALE"),className:`py-2.5 rounded-xl text-sm font-medium transition-all ${"MALE"===x?"bg-blue-50 text-blue-700 border-2 border-blue-300":"bg-white text-surface-500 border border-surface-200 hover:bg-surface-50"}`,children:"ğŸ‘¨ Laki-laki"}),(0,s.jsx)("button",{type:"button",onClick:()=>m("FEMALE"),className:`py-2.5 rounded-xl text-sm font-medium transition-all ${"FEMALE"===x?"bg-pink-50 text-pink-700 border-2 border-pink-300":"bg-white text-surface-500 border border-surface-200 hover:bg-surface-50"}`,children:"ğŸ‘© Perempuan"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-surface-700 mb-1.5",children:"Status"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,s.jsx)("button",{type:"button",onClick:()=>p(!0),className:`py-2.5 rounded-xl text-sm font-medium transition-all ${u?"bg-green-50 text-green-700 border-2 border-green-300":"bg-white text-surface-500 border border-surface-200 hover:bg-surface-50"}`,children:"â¤ï¸ Hidup"}),(0,s.jsx)("button",{type:"button",onClick:()=>p(!1),className:`py-2.5 rounded-xl text-sm font-medium transition-all ${!u?"bg-surface-100 text-surface-700 border-2 border-surface-300":"bg-white text-surface-500 border border-surface-200 hover:bg-surface-50"}`,children:"ğŸ•Šï¸ Wafat"})]})]}),(0,s.jsxs)("div",{className:"flex gap-3 pt-2",children:[(0,s.jsx)("button",{type:"button",onClick:l,className:"flex-1 py-2.5 rounded-xl border border-surface-200 text-surface-600 font-medium text-sm hover:bg-surface-50 transition-colors",children:"Batal"}),(0,s.jsx)("button",{type:"submit",disabled:f||!n.trim(),className:"flex-1 py-2.5 rounded-xl bg-gradient-to-r from-primary-600 to-primary-700 text-white font-semibold text-sm hover:from-primary-500 hover:to-primary-600 transition-all shadow-lg shadow-primary-600/20 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:f?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(g.Loader2,{className:"w-4 h-4 animate-spin"}),"Menyimpan..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(h.Plus,{className:"w-4 h-4"}),"Simpan"]})})]})]})]})]})}function U({node:e,level:a,expanded:t,toggleExpand:r,selectedId:l,onSelect:i,onShowQuickMenu:n,canEdit:m=!0,orientation:u}){let p,f=t.has(e.id),b=e.children.length>0,g=l===e.id,j="HORIZONTAL"===u,v=(0,s.jsxs)("div",{onClick:()=>i(e.id),className:`tree-node relative cursor-pointer rounded-xl sm:rounded-2xl border-2 p-2 sm:p-3 w-28 sm:w-44 text-center transition-all group ${g?"border-primary-500 bg-primary-50 shadow-lg shadow-primary-500/20":e.isAlive?"MALE"===e.gender?"border-blue-200 bg-white hover:border-blue-400":"border-pink-200 bg-white hover:border-pink-400":"border-surface-200 bg-surface-50 opacity-80 hover:opacity-100"}`,children:[(0,s.jsx)("div",{className:`w-9 h-9 sm:w-12 sm:h-12 rounded-full mx-auto mb-1 sm:mb-2 flex items-center justify-center ${"MALE"===e.gender?"bg-blue-100 text-blue-600":"bg-pink-100 text-pink-600"}`,children:e.photo?(0,s.jsx)("img",{src:e.photo,alt:e.fullName,className:"w-9 h-9 sm:w-12 sm:h-12 rounded-full object-cover"}):(0,s.jsx)(d.User,{className:"w-4 h-4 sm:w-6 sm:h-6"})}),(0,s.jsx)("p",{className:"text-xs sm:text-sm font-semibold text-surface-900 truncate",children:e.fullName}),e.nickname&&(0,s.jsxs)("p",{className:"text-[10px] text-surface-400 truncate",children:["(",e.nickname,")"]}),!e.isAlive&&(0,s.jsx)("span",{className:"inline-block text-[10px] px-1.5 py-0.5 rounded bg-surface-200 text-surface-500 mt-1",children:"Alm."}),(p=[],("MALE"===e.gender&&e.marriagesAsHusband?e.marriagesAsHusband.forEach(e=>p.push(e.wife.fullName)):"FEMALE"===e.gender&&e.marriagesAsWife&&e.marriagesAsWife.forEach(e=>p.push(e.husband.fullName)),0===p.length)?null:(0,s.jsx)("div",{className:"mt-1.5 space-y-0.5",children:p.map((a,t)=>(0,s.jsxs)("p",{className:`text-[9px] sm:text-[10px] truncate px-1.5 py-0.5 rounded-full ${"MALE"===e.gender?"bg-pink-50 text-pink-500":"bg-blue-50 text-blue-500"}`,children:["ğŸ’‘ ",a]},t))})),g&&m&&e.phoneWhatsapp&&(0,s.jsx)("a",{href:(0,O.getWhatsAppLink)(e.phoneWhatsapp),target:"_blank",rel:"noopener noreferrer",onClick:e=>e.stopPropagation(),className:"absolute -top-2 -right-2 w-6 h-6 rounded-full bg-green-500 text-white flex items-center justify-center shadow-md hover:bg-green-400 transition-all animate-scale-in z-10",children:(0,s.jsx)(c.Phone,{className:"w-3 h-3"})}),g&&m&&(0,s.jsx)("button",{onClick:s=>{s.stopPropagation(),n(e)},className:"absolute -top-2 -left-2 z-30 w-6 h-6 rounded-full bg-emerald-500 text-white flex items-center justify-center shadow-md hover:bg-emerald-400 transition-all hover:scale-110 animate-scale-in",title:"Tambah keluarga",children:(0,s.jsx)(h.Plus,{className:"w-3 h-3"})}),b&&(0,s.jsx)("button",{onClick:s=>{s.stopPropagation(),r(e.id)},className:j?"absolute top-1/2 -right-3 -translate-y-1/2 w-6 h-6 rounded-full bg-primary-500 text-white flex items-center justify-center shadow-md hover:bg-primary-400 transition-colors text-xs":"absolute -bottom-3 left-1/2 -translate-x-1/2 w-6 h-6 rounded-full bg-primary-500 text-white flex items-center justify-center shadow-md hover:bg-primary-400 transition-colors text-xs",children:j?f?(0,s.jsx)(y.ChevronLeft,{className:"w-3.5 h-3.5"}):(0,s.jsx)(N.ChevronRight,{className:"w-3.5 h-3.5"}):f?(0,s.jsx)(x.ChevronUp,{className:"w-3.5 h-3.5"}):(0,s.jsx)(o.ChevronDown,{className:"w-3.5 h-3.5"})})]});return j?(0,s.jsxs)("div",{className:"flex flex-row items-center",children:[v,b&&f&&(0,s.jsxs)("div",{className:"flex flex-row items-center",children:[(0,s.jsx)("div",{className:"h-0.5 w-8 bg-gradient-to-r from-primary-300 to-primary-200"}),(0,s.jsx)("div",{className:"flex flex-col",children:e.children.map((c,d)=>(0,s.jsxs)("div",{className:"flex flex-row items-center relative",children:[e.children.length>1&&(0,s.jsxs)("div",{className:"flex flex-col w-0.5 self-stretch",children:[(0,s.jsx)("div",{className:`flex-1 w-full ${0===d?"bg-transparent":"bg-primary-200"}`}),(0,s.jsx)("div",{className:`flex-1 w-full ${d===e.children.length-1?"bg-transparent":"bg-primary-200"}`})]}),(0,s.jsx)("div",{className:"h-0.5 w-6 bg-primary-200"}),(0,s.jsx)("div",{className:"py-2 sm:py-3",children:(0,s.jsx)(U,{node:c,level:a+1,expanded:t,toggleExpand:r,selectedId:l,onSelect:i,onShowQuickMenu:n,canEdit:m,orientation:u})})]},c.id))})]})]}):(0,s.jsxs)("div",{className:"flex flex-col items-center",children:[v,b&&f&&(0,s.jsxs)("div",{className:"flex flex-col items-center",children:[(0,s.jsx)("div",{className:"w-0.5 h-8 bg-gradient-to-b from-primary-300 to-primary-200"}),(0,s.jsx)("div",{className:"flex",children:e.children.map((c,d)=>(0,s.jsxs)("div",{className:"flex flex-col items-center relative",children:[e.children.length>1&&(0,s.jsxs)("div",{className:"flex w-full h-0.5",children:[(0,s.jsx)("div",{className:`flex-1 h-full ${0===d?"bg-transparent":"bg-primary-200"}`}),(0,s.jsx)("div",{className:`flex-1 h-full ${d===e.children.length-1?"bg-transparent":"bg-primary-200"}`})]}),(0,s.jsx)("div",{className:"w-0.5 h-6 bg-primary-200"}),(0,s.jsx)("div",{className:"px-2 sm:px-3",children:(0,s.jsx)(U,{node:c,level:a+1,expanded:t,toggleExpand:r,selectedId:l,onSelect:i,onShowQuickMenu:n,canEdit:m,orientation:u})})]},c.id))})]})]})}function K({members:e,baniId:t,onSelectMember:r}){let[l,i]=(0,a.useState)(""),[n,c]=(0,a.useState)(null),o=Array.from({length:Math.max(...e.map(e=>e.generation),0)+1},(e,s)=>s),x=e.filter(e=>{let s=e.fullName.toLowerCase().includes(l.toLowerCase())||e.nickname?.toLowerCase().includes(l.toLowerCase())||e.city?.toLowerCase().includes(l.toLowerCase()),a=null===n||e.generation===n;return s&&a}),m=x.reduce((e,s)=>(e[s.generation]||(e[s.generation]=[]),e[s.generation].push(s),e),{});return(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,s.jsxs)("div",{className:"relative flex-1",children:[(0,s.jsx)(u.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-surface-400"}),(0,s.jsx)("input",{type:"text",value:l,onChange:e=>i(e.target.value),className:"w-full pl-9 pr-3 py-2.5 rounded-xl border border-surface-200 text-sm text-surface-900 placeholder-surface-400 focus:outline-none focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 transition-all",placeholder:"Cari nama..."})]}),(0,s.jsxs)("select",{value:null===n?"":n,onChange:e=>c(""===e.target.value?null:parseInt(e.target.value)),className:"px-3 py-2.5 rounded-xl border border-surface-200 text-sm text-surface-700 focus:outline-none focus:border-primary-500 bg-white min-w-[100px]",children:[(0,s.jsx)("option",{value:"",children:"Semua"}),o.map(e=>(0,s.jsxs)("option",{value:e,children:["Gen ",e+1]},e))]})]}),Object.keys(m).sort((e,s)=>Number(e)-Number(s)).map(e=>(0,s.jsxs)("div",{children:[(0,s.jsxs)("h3",{className:"text-xs font-semibold text-surface-400 uppercase tracking-wider mb-2",children:["Generasi ",Number(e)+1]}),(0,s.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:m[Number(e)].map(e=>(0,s.jsxs)("button",{onClick:()=>r(e),className:"group p-3 rounded-xl bg-white border border-surface-200 hover:border-primary-200 hover:shadow-md transition-all flex items-center gap-3 text-left w-full",children:[(0,s.jsx)("div",{className:`w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0 ${"MALE"===e.gender?"bg-blue-50 text-blue-600":"bg-pink-50 text-pink-600"} ${!e.isAlive?"opacity-60":""}`,children:e.photo?(0,s.jsx)("img",{src:e.photo,alt:e.fullName,className:"w-10 h-10 rounded-full object-cover"}):(0,s.jsx)(d.User,{className:"w-5 h-5"})}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,s.jsx)("p",{className:"text-sm font-semibold text-surface-900 truncate",children:e.fullName}),!e.isAlive&&(0,s.jsx)("span",{className:"text-[10px] px-1 py-0.5 rounded bg-surface-100 text-surface-400 flex-shrink-0",children:"Alm."})]}),e.nickname&&(0,s.jsx)("p",{className:"text-xs text-surface-400 truncate",children:e.nickname}),e.city&&(0,s.jsxs)("p",{className:"text-[11px] text-surface-400 mt-0.5",children:["ğŸ“ ",e.city]})]}),(0,s.jsx)(N.ChevronRight,{className:"w-4 h-4 text-surface-300 group-hover:text-primary-500 transition-colors flex-shrink-0"})]},e.id))})]},e)),0===x.length&&(0,s.jsxs)("div",{className:"text-center py-12 rounded-xl bg-white border border-surface-200",children:[(0,s.jsx)(d.User,{className:"w-10 h-10 text-surface-300 mx-auto mb-3"}),(0,s.jsx)("p",{className:"text-surface-500 text-sm",children:"Tidak ada anggota ditemukan"})]})]})}function Z({member:e,baniId:a,onClose:t,onEdit:r}){let l=e=>{if(!e)return null;try{return new Date(e).toLocaleDateString("id-ID",{day:"numeric",month:"long",year:"numeric"})}catch{return e}},i=e.socialMedia,n=i?Object.entries(i).filter(([,e])=>e):[],o=e.phoneWhatsapp||n.length>0,x=e.address||e.city,m=e.birthDate||e.deathDate,u=e.father||e.mother;return(0,s.jsxs)("div",{className:"fixed inset-0 z-[100] flex items-start justify-center p-4 pt-8 sm:items-center sm:pt-4",onClick:t,children:[(0,s.jsx)("div",{className:"absolute inset-0 bg-black/40 backdrop-blur-sm"}),(0,s.jsxs)("div",{className:"relative w-full max-w-md bg-white rounded-2xl shadow-2xl animate-scale-in overflow-hidden max-h-[90vh] flex flex-col",onClick:e=>e.stopPropagation(),children:[(0,s.jsxs)("div",{className:`relative px-5 pt-5 pb-4 flex-shrink-0 ${"MALE"===e.gender?"bg-gradient-to-br from-blue-50 to-blue-100/50":"bg-gradient-to-br from-pink-50 to-pink-100/50"}`,children:[(0,s.jsx)("button",{onClick:t,className:"absolute top-3 right-3 w-8 h-8 rounded-full bg-white/80 flex items-center justify-center hover:bg-white transition-colors",children:(0,s.jsx)(j.X,{className:"w-4 h-4 text-surface-500"})}),(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)("div",{className:`w-16 h-16 rounded-2xl flex items-center justify-center text-xl font-bold ${"MALE"===e.gender?"bg-blue-200/60 text-blue-600":"bg-pink-200/60 text-pink-600"} ${!e.isAlive?"opacity-60":""}`,children:e.photo?(0,s.jsx)("img",{src:e.photo,alt:e.fullName,className:"w-16 h-16 rounded-2xl object-cover"}):(0,s.jsx)(d.User,{className:"w-8 h-8"})}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(0,s.jsx)("h3",{className:"text-lg font-bold text-surface-900",children:e.fullName}),!e.isAlive&&(0,s.jsx)("span",{className:"px-1.5 py-0.5 rounded-lg bg-surface-200/80 text-surface-500 text-[10px] font-medium",children:"ğŸ•Šï¸ Almarhum/ah"})]}),e.nickname&&(0,s.jsxs)("p",{className:"text-sm text-surface-500",children:['"',e.nickname,'"']}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-1.5 mt-1.5",children:[(0,s.jsx)("span",{className:`text-[11px] px-2 py-0.5 rounded-full font-medium ${"MALE"===e.gender?"bg-blue-200/60 text-blue-700":"bg-pink-200/60 text-pink-700"}`,children:"MALE"===e.gender?"ğŸ‘¨ Laki-laki":"ğŸ‘© Perempuan"}),(0,s.jsxs)("span",{className:"text-[11px] px-2 py-0.5 rounded-full bg-primary-100/60 text-primary-700 font-medium",children:["Generasi ",e.generation+1]})]})]})]}),e.bio&&(0,s.jsx)("p",{className:"mt-3 text-sm text-surface-600 leading-relaxed",children:e.bio})]}),(0,s.jsxs)("div",{className:"overflow-y-auto flex-1 px-5 py-4 space-y-4",children:[m&&(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("h4",{className:"text-[11px] font-semibold text-surface-400 uppercase tracking-wider flex items-center gap-1.5",children:[(0,s.jsx)(C,{className:"w-3.5 h-3.5"})," Tanggal"]}),e.birthDate&&(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-[11px] text-surface-400",children:"Tanggal Lahir"}),(0,s.jsxs)("p",{className:"text-sm text-surface-900 font-medium",children:[l(e.birthDate),e.birthPlace?` â€” ${e.birthPlace}`:""]})]}),e.deathDate&&(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-[11px] text-surface-400",children:"Tanggal Wafat"}),(0,s.jsx)("p",{className:"text-sm text-surface-900 font-medium",children:l(e.deathDate)})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("h4",{className:"text-[11px] font-semibold text-surface-400 uppercase tracking-wider flex items-center gap-1.5",children:[(0,s.jsx)(c.Phone,{className:"w-3.5 h-3.5"})," Kontak"]}),o?(0,s.jsxs)(s.Fragment,{children:[e.phoneWhatsapp&&(0,s.jsx)("div",{className:"flex items-center gap-2",children:(0,s.jsxs)("a",{href:(0,O.getWhatsAppLink)(e.phoneWhatsapp),target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 text-sm text-green-600 font-medium hover:text-green-500",children:[(0,s.jsx)(c.Phone,{className:"w-3.5 h-3.5"}),e.phoneWhatsapp]})}),n.map(([e,a])=>{let t=R.find(s=>s.key===e);return(0,s.jsxs)("a",{href:D(e,a),target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 hover:opacity-80 transition-opacity",children:[(0,s.jsx)("div",{className:`w-6 h-6 rounded-md ${t?.bg||"bg-surface-100"} ${t?.color||"text-surface-500"} flex items-center justify-center`,children:(0,s.jsx)(H,{platform:e,className:"w-3 h-3"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-[11px] text-surface-400",children:t?.label||e}),(0,s.jsx)("p",{className:"text-sm text-surface-900",children:a})]})]},e)})]}):(0,s.jsx)("p",{className:"text-sm text-surface-400",children:"Belum diisi"})]}),x&&(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("h4",{className:"text-[11px] font-semibold text-surface-400 uppercase tracking-wider flex items-center gap-1.5",children:[(0,s.jsx)(w,{className:"w-3.5 h-3.5"})," Alamat"]}),e.address&&(0,s.jsx)("p",{className:"text-sm text-surface-900",children:e.address}),e.city&&(0,s.jsxs)("p",{className:"text-sm text-surface-600",children:["ğŸ“ ",e.city]})]}),u&&(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("h4",{className:"text-[11px] font-semibold text-surface-400 uppercase tracking-wider flex items-center gap-1.5",children:[(0,s.jsx)(d.User,{className:"w-3.5 h-3.5"})," Orang Tua"]}),e.father&&(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"w-7 h-7 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center",children:(0,s.jsx)(d.User,{className:"w-3.5 h-3.5"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-[11px] text-surface-400",children:"Ayah"}),(0,s.jsx)("p",{className:"text-sm text-surface-900 font-medium",children:e.father.fullName})]})]}),e.mother&&(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"w-7 h-7 rounded-full bg-pink-100 text-pink-600 flex items-center justify-center",children:(0,s.jsx)(d.User,{className:"w-3.5 h-3.5"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-[11px] text-surface-400",children:"Ibu"}),(0,s.jsx)("p",{className:"text-sm text-surface-900 font-medium",children:e.mother.fullName})]})]})]})]}),(0,s.jsxs)("div",{className:"px-5 pb-4 pt-2 flex gap-2 flex-shrink-0 border-t border-surface-100",children:[e.phoneWhatsapp&&(0,s.jsxs)("a",{href:(0,O.getWhatsAppLink)(e.phoneWhatsapp),target:"_blank",rel:"noopener noreferrer",className:"flex-1 inline-flex items-center justify-center gap-2 px-4 py-2.5 rounded-xl bg-green-500 text-white text-sm font-medium hover:bg-green-400 transition-colors",children:[(0,s.jsx)(c.Phone,{className:"w-4 h-4"}),"WhatsApp"]}),(0,s.jsxs)("button",{onClick:()=>{t(),r(e.id)},className:"flex-1 inline-flex items-center justify-center gap-2 px-4 py-2.5 rounded-xl border border-primary-200 text-primary-600 text-sm font-medium hover:bg-primary-50 transition-colors",children:[(0,s.jsx)(A,{className:"w-4 h-4"}),"Edit"]})]})]})]})}function G({baniId:e,existingMembers:t,onClose:r,onSuccess:l}){let[i,n]=(0,a.useState)(!1),[c,d]=(0,a.useState)(""),[o,x]=(0,a.useState)(""),[m,u]=(0,a.useState)(""),[h,p]=(0,a.useState)("MALE"),[f,b]=(0,a.useState)(""),[N,y]=(0,a.useState)(""),[v,k]=(0,a.useState)(!0),[w,C]=(0,a.useState)(""),[A,S]=(0,a.useState)(""),[L,M]=(0,a.useState)(""),[E,P]=(0,a.useState)(""),[T,$]=(0,a.useState)([]),[I,W]=(0,a.useState)(""),[O,z]=(0,a.useState)(""),[R,D]=(0,a.useState)(""),H=t.filter(e=>"MALE"===e.gender),B=t.filter(e=>"FEMALE"===e.gender),V=async s=>{s.preventDefault(),d(""),n(!0);try{let s={};T.forEach(e=>{e.value&&(s[e.key]=e.value)});let a=await fetch("/api/members",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({baniId:e,fullName:o,nickname:m||void 0,gender:h,birthDate:f||void 0,birthPlace:N||void 0,isAlive:v,deathDate:!v&&w?w:void 0,address:A||void 0,city:L||void 0,phoneWhatsapp:E||void 0,socialMedia:Object.keys(s).length>0?s:void 0,bio:I||void 0,fatherId:O||void 0,motherId:R||void 0})}),t=await a.json();if(!a.ok)return void d(t.error||"Gagal menyimpan");l(),r()}catch{d("Terjadi kesalahan. Silakan coba lagi.")}finally{n(!1)}},U="w-full px-3 py-2.5 rounded-xl border border-surface-200 text-sm text-surface-900 placeholder-surface-400 focus:outline-none focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 transition-all",K="block text-xs font-medium text-surface-600 mb-1";return(0,s.jsxs)("div",{className:"fixed inset-0 z-[100] flex items-start justify-center p-4 pt-8 sm:items-center sm:pt-4",onClick:r,children:[(0,s.jsx)("div",{className:"absolute inset-0 bg-black/40 backdrop-blur-sm"}),(0,s.jsxs)("div",{className:"relative w-full max-w-md bg-white rounded-2xl shadow-2xl animate-scale-in overflow-hidden max-h-[90vh] flex flex-col",onClick:e=>e.stopPropagation(),children:[(0,s.jsxs)("div",{className:"flex items-center justify-between px-5 py-4 border-b border-surface-100 flex-shrink-0",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-lg font-bold text-surface-900",children:"Tambah Anggota"}),(0,s.jsx)("p",{className:"text-xs text-surface-400",children:"Tambahkan anggota baru ke pohon nasab"})]}),(0,s.jsx)("button",{onClick:r,className:"w-8 h-8 rounded-full bg-surface-100 flex items-center justify-center hover:bg-surface-200 transition-colors",children:(0,s.jsx)(j.X,{className:"w-4 h-4 text-surface-500"})})]}),(0,s.jsxs)("div",{className:"overflow-y-auto flex-1 px-5 py-4",children:[c&&(0,s.jsx)("div",{className:"mb-4 p-3 rounded-xl bg-red-50 border border-red-200 text-red-700 text-xs",children:c}),(0,s.jsxs)("form",{id:"add-member-form",onSubmit:V,className:"space-y-4",children:[(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)("h3",{className:"text-xs font-semibold text-surface-400 uppercase tracking-wider",children:"Data Dasar"}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:K,children:["Nama Lengkap ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsx)("input",{type:"text",value:o,onChange:e=>x(e.target.value),className:U,placeholder:"Nama lengkap",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:K,children:"Nama Panggilan"}),(0,s.jsx)("input",{type:"text",value:m,onChange:e=>u(e.target.value),className:U,placeholder:"Panggilan sehari-hari"})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:K,children:["Jenis Kelamin ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("button",{type:"button",onClick:()=>p("MALE"),className:`flex-1 py-2.5 rounded-xl border text-xs font-medium transition-all ${"MALE"===h?"border-blue-500 bg-blue-50 text-blue-700":"border-surface-200 text-surface-500"}`,children:"ğŸ‘¨ Laki-laki"}),(0,s.jsx)("button",{type:"button",onClick:()=>p("FEMALE"),className:`flex-1 py-2.5 rounded-xl border text-xs font-medium transition-all ${"FEMALE"===h?"border-pink-500 bg-pink-50 text-pink-700":"border-surface-200 text-surface-500"}`,children:"ğŸ‘© Perempuan"})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:K,children:"Tanggal Lahir"}),(0,s.jsx)("input",{type:"date",value:f,onChange:e=>b(e.target.value),className:U})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:K,children:"Tempat Lahir"}),(0,s.jsx)("input",{type:"text",value:N,onChange:e=>y(e.target.value),className:U,placeholder:"Kota"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:K,children:"Status"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("button",{type:"button",onClick:()=>{k(!0),C("")},className:`flex-1 py-2.5 rounded-xl border text-xs font-medium transition-all ${v?"border-green-500 bg-green-50 text-green-700":"border-surface-200 text-surface-500"}`,children:"â¤ï¸ Masih Hidup"}),(0,s.jsx)("button",{type:"button",onClick:()=>k(!1),className:`flex-1 py-2.5 rounded-xl border text-xs font-medium transition-all ${!v?"border-surface-500 bg-surface-100 text-surface-700":"border-surface-200 text-surface-500"}`,children:"ğŸ•Šï¸ Sudah Wafat"})]})]}),!v&&(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:K,children:"Tanggal Wafat"}),(0,s.jsx)("input",{type:"date",value:w,onChange:e=>C(e.target.value),className:U})]})]}),(0,s.jsxs)("div",{className:"space-y-3 pt-2 border-t border-surface-100",children:[(0,s.jsx)("h3",{className:"text-xs font-semibold text-surface-400 uppercase tracking-wider",children:"Relasi Keluarga"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:K,children:"Ayah"}),(0,s.jsxs)("select",{value:O,onChange:e=>z(e.target.value),className:U,children:[(0,s.jsx)("option",{value:"",children:"-- Pilih Ayah --"}),H.map(e=>(0,s.jsxs)("option",{value:e.id,children:[e.fullName," (Gen. ",e.generation+1,")"]},e.id))]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:K,children:"Ibu"}),(0,s.jsxs)("select",{value:R,onChange:e=>D(e.target.value),className:U,children:[(0,s.jsx)("option",{value:"",children:"-- Pilih Ibu --"}),B.map(e=>(0,s.jsxs)("option",{value:e.id,children:[e.fullName," (Gen. ",e.generation+1,")"]},e.id))]})]})]}),(0,s.jsxs)("div",{className:"space-y-3 pt-2 border-t border-surface-100",children:[(0,s.jsx)("h3",{className:"text-xs font-semibold text-surface-400 uppercase tracking-wider",children:"Kontak & Alamat"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:K,children:"No. WhatsApp"}),(0,s.jsx)("input",{type:"tel",value:E,onChange:e=>P(e.target.value),className:U,placeholder:"08xxxxxxxxxx"})]}),(0,s.jsx)(F,{entries:T,onChange:$,inputClass:U,labelClass:K}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:K,children:"Alamat"}),(0,s.jsx)("input",{type:"text",value:A,onChange:e=>S(e.target.value),className:U,placeholder:"Alamat"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:K,children:"Kota"}),(0,s.jsx)("input",{type:"text",value:L,onChange:e=>M(e.target.value),className:U,placeholder:"Kota"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:K,children:"Bio / Catatan"}),(0,s.jsx)("textarea",{value:I,onChange:e=>W(e.target.value),rows:2,className:`${U} resize-none`,placeholder:"Catatan tentang anggota ini"})]})]})]})]}),(0,s.jsxs)("div",{className:"flex gap-2 px-5 py-4 border-t border-surface-100 flex-shrink-0",children:[(0,s.jsx)("button",{type:"button",onClick:r,className:"flex-1 py-2.5 rounded-xl border border-surface-200 text-surface-600 font-medium text-sm hover:bg-surface-50 transition-colors",children:"Batal"}),(0,s.jsx)("button",{type:"submit",form:"add-member-form",disabled:i,className:"flex-1 py-2.5 rounded-xl bg-gradient-to-r from-primary-600 to-primary-700 text-white font-semibold text-sm hover:from-primary-500 hover:to-primary-600 transition-all shadow-lg shadow-primary-600/20 disabled:opacity-50 flex items-center justify-center gap-2",children:i?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(g.Loader2,{className:"w-4 h-4 animate-spin"}),"Menyimpan..."]}):"Simpan"})]})]})]})}function X({memberId:e,baniId:t,allMembers:r,onClose:l,onSuccess:i}){let[n,c]=(0,a.useState)(!0),[d,o]=(0,a.useState)(!1),[x,m]=(0,a.useState)(!1),[u,h]=(0,a.useState)(""),[p,f]=(0,a.useState)(""),[b,N]=(0,a.useState)(""),[y,v]=(0,a.useState)("MALE"),[k,w]=(0,a.useState)(""),[C,A]=(0,a.useState)(""),[L,M]=(0,a.useState)(!0),[E,P]=(0,a.useState)(""),[T,$]=(0,a.useState)(""),[I,W]=(0,a.useState)(""),[O,z]=(0,a.useState)(""),[R,D]=(0,a.useState)([]),[H,B]=(0,a.useState)(""),[V,U]=(0,a.useState)(""),[K,Z]=(0,a.useState)("");(0,a.useEffect)(()=>{(async()=>{try{let s=await fetch(`/api/members/${e}`,{credentials:"include"});if(!s.ok){let e=await s.json().catch(()=>({}));h(e.error||`Error ${s.status}`),c(!1);return}let a=await s.json();f(a.fullName),N(a.nickname||""),v(a.gender),w(a.birthDate?a.birthDate.split("T")[0]:""),A(a.birthPlace||""),M(a.isAlive),P(a.deathDate?a.deathDate.split("T")[0]:""),$(a.address||""),W(a.city||""),z(a.phoneWhatsapp||"");let t=a.socialMedia;t&&D(Object.entries(t).filter(([,e])=>e).map(([e,s])=>({key:e,value:s}))),B(a.bio||""),U(a.fatherId||""),Z(a.motherId||"")}catch(e){console.error("Failed to fetch:",e),h("Gagal memuat data")}finally{c(!1)}})()},[e]);let G=async s=>{s.preventDefault(),h(""),o(!0);try{let s={};R.forEach(e=>{e.value&&(s[e.key]=e.value)});let a=await fetch(`/api/members/${e}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({fullName:p,nickname:b||void 0,gender:y,birthDate:k||void 0,birthPlace:C||void 0,isAlive:L,deathDate:!L&&E?E:void 0,address:T||void 0,city:I||void 0,phoneWhatsapp:O||void 0,socialMedia:Object.keys(s).length>0?s:void 0,bio:H||void 0,fatherId:V||void 0,motherId:K||void 0})}),t=await a.json();if(!a.ok)return void h(t.error);i()}catch{h("Terjadi kesalahan. Silakan coba lagi.")}finally{o(!1)}},X=async()=>{if(confirm("Apakah Anda yakin ingin menghapus anggota ini? Tindakan ini tidak dapat dibatalkan.")){m(!0);try{let s=await fetch(`/api/members/${e}`,{method:"DELETE"});if(!s.ok){let e=await s.json();h(e.error);return}i()}catch{h("Gagal menghapus anggota")}finally{m(!1)}}},J=r.filter(s=>"MALE"===s.gender&&s.id!==e),q=r.filter(s=>"FEMALE"===s.gender&&s.id!==e),_="w-full px-3 py-2.5 rounded-xl border border-surface-200 text-sm text-surface-900 placeholder-surface-400 focus:outline-none focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 transition-all",Q="block text-xs font-medium text-surface-600 mb-1";return(0,s.jsxs)("div",{className:"fixed inset-0 z-[100] flex items-start justify-center p-4 pt-8 sm:items-center sm:pt-4",onClick:l,children:[(0,s.jsx)("div",{className:"absolute inset-0 bg-black/40 backdrop-blur-sm"}),(0,s.jsxs)("div",{className:"relative w-full max-w-md bg-white rounded-2xl shadow-2xl animate-scale-in overflow-hidden max-h-[90vh] flex flex-col",onClick:e=>e.stopPropagation(),children:[(0,s.jsxs)("div",{className:"flex items-center justify-between px-5 py-4 border-b border-surface-100 flex-shrink-0",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-lg font-bold text-surface-900",children:"Edit Anggota"}),p&&(0,s.jsxs)("p",{className:"text-xs text-surface-400",children:["Ubah data ",p]})]}),(0,s.jsx)("button",{onClick:l,className:"w-8 h-8 rounded-full bg-surface-100 flex items-center justify-center hover:bg-surface-200 transition-colors",children:(0,s.jsx)(j.X,{className:"w-4 h-4 text-surface-500"})})]}),n?(0,s.jsx)("div",{className:"flex items-center justify-center py-20",children:(0,s.jsx)(g.Loader2,{className:"w-8 h-8 animate-spin text-primary-500"})}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"overflow-y-auto flex-1 px-5 py-4",children:[u&&(0,s.jsx)("div",{className:"mb-4 p-3 rounded-xl bg-red-50 border border-red-200 text-red-700 text-xs",children:u}),(0,s.jsxs)("form",{id:"edit-member-form",onSubmit:G,className:"space-y-4",children:[(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)("h3",{className:"text-xs font-semibold text-surface-400 uppercase tracking-wider",children:"Data Dasar"}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:Q,children:["Nama Lengkap ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsx)("input",{type:"text",value:p,onChange:e=>f(e.target.value),className:_,required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:Q,children:"Nama Panggilan"}),(0,s.jsx)("input",{type:"text",value:b,onChange:e=>N(e.target.value),className:_})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:Q,children:"Jenis Kelamin"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("button",{type:"button",onClick:()=>v("MALE"),className:`flex-1 py-2.5 rounded-xl border text-xs font-medium transition-all ${"MALE"===y?"border-blue-500 bg-blue-50 text-blue-700":"border-surface-200 text-surface-500"}`,children:"ğŸ‘¨ Laki-laki"}),(0,s.jsx)("button",{type:"button",onClick:()=>v("FEMALE"),className:`flex-1 py-2.5 rounded-xl border text-xs font-medium transition-all ${"FEMALE"===y?"border-pink-500 bg-pink-50 text-pink-700":"border-surface-200 text-surface-500"}`,children:"ğŸ‘© Perempuan"})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:Q,children:"Tanggal Lahir"}),(0,s.jsx)("input",{type:"date",value:k,onChange:e=>w(e.target.value),className:_})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:Q,children:"Tempat Lahir"}),(0,s.jsx)("input",{type:"text",value:C,onChange:e=>A(e.target.value),className:_})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:Q,children:"Status"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("button",{type:"button",onClick:()=>{M(!0),P("")},className:`flex-1 py-2.5 rounded-xl border text-xs font-medium transition-all ${L?"border-green-500 bg-green-50 text-green-700":"border-surface-200 text-surface-500"}`,children:"â¤ï¸ Masih Hidup"}),(0,s.jsx)("button",{type:"button",onClick:()=>M(!1),className:`flex-1 py-2.5 rounded-xl border text-xs font-medium transition-all ${!L?"border-surface-500 bg-surface-100 text-surface-700":"border-surface-200 text-surface-500"}`,children:"ğŸ•Šï¸ Sudah Wafat"})]})]}),!L&&(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:Q,children:"Tanggal Wafat"}),(0,s.jsx)("input",{type:"date",value:E,onChange:e=>P(e.target.value),className:_})]})]}),(0,s.jsxs)("div",{className:"space-y-3 pt-2 border-t border-surface-100",children:[(0,s.jsx)("h3",{className:"text-xs font-semibold text-surface-400 uppercase tracking-wider",children:"Relasi Keluarga"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:Q,children:"Ayah"}),(0,s.jsxs)("select",{value:V,onChange:e=>U(e.target.value),className:_,children:[(0,s.jsx)("option",{value:"",children:"-- Pilih Ayah --"}),J.map(e=>(0,s.jsxs)("option",{value:e.id,children:[e.fullName," (Gen. ",e.generation+1,")"]},e.id))]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:Q,children:"Ibu"}),(0,s.jsxs)("select",{value:K,onChange:e=>Z(e.target.value),className:_,children:[(0,s.jsx)("option",{value:"",children:"-- Pilih Ibu --"}),q.map(e=>(0,s.jsxs)("option",{value:e.id,children:[e.fullName," (Gen. ",e.generation+1,")"]},e.id))]})]})]}),(0,s.jsxs)("div",{className:"space-y-3 pt-2 border-t border-surface-100",children:[(0,s.jsx)("h3",{className:"text-xs font-semibold text-surface-400 uppercase tracking-wider",children:"Kontak & Alamat"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:Q,children:"No. WhatsApp"}),(0,s.jsx)("input",{type:"tel",value:O,onChange:e=>z(e.target.value),className:_,placeholder:"08xxxxxxxxxx"})]}),(0,s.jsx)(F,{entries:R,onChange:D,inputClass:_,labelClass:Q}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:Q,children:"Alamat"}),(0,s.jsx)("input",{type:"text",value:T,onChange:e=>$(e.target.value),className:_})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:Q,children:"Kota"}),(0,s.jsx)("input",{type:"text",value:I,onChange:e=>W(e.target.value),className:_})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:Q,children:"Bio / Catatan"}),(0,s.jsx)("textarea",{value:H,onChange:e=>B(e.target.value),rows:2,className:`${_} resize-none`})]})]})]})]}),(0,s.jsxs)("div",{className:"flex gap-2 px-5 py-4 border-t border-surface-100 flex-shrink-0",children:[(0,s.jsx)("button",{type:"button",onClick:X,disabled:x,className:"px-3 py-2.5 rounded-xl border border-red-200 text-red-600 hover:bg-red-50 transition-colors disabled:opacity-50 flex items-center gap-1",children:x?(0,s.jsx)(g.Loader2,{className:"w-4 h-4 animate-spin"}):(0,s.jsx)(S.Trash2,{className:"w-4 h-4"})}),(0,s.jsx)("button",{type:"button",onClick:l,className:"flex-1 py-2.5 rounded-xl border border-surface-200 text-surface-600 font-medium text-sm hover:bg-surface-50 transition-colors",children:"Batal"}),(0,s.jsx)("button",{type:"submit",form:"edit-member-form",disabled:d,className:"flex-1 py-2.5 rounded-xl bg-gradient-to-r from-primary-600 to-primary-700 text-white font-semibold text-sm hover:from-primary-500 hover:to-primary-600 transition-all shadow-lg shadow-primary-600/20 disabled:opacity-50 flex items-center justify-center gap-2",children:d?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(g.Loader2,{className:"w-4 h-4 animate-spin"}),"Menyimpan..."]}):"Simpan"})]})]})]})]})}function J({baniId:e,baniName:i,members:o,canEdit:x,initialOrientation:m="VERTICAL",initialIsPublic:u=!1,initialShowWa:p=!1,initialShowBirth:f=!1,initialShowAddress:b=!1,initialShowSocmed:g=!1}){let N,y,C,[S,F]=(0,a.useState)("tree"),[J,q]=(0,a.useState)([]),[_,Q]=(0,a.useState)(!0),[Y,ee]=(0,a.useState)(new Set),[es,ea]=(0,a.useState)(null),[et,er]=(0,a.useState)(1),el=(0,a.useRef)(null),ei=(0,a.useRef)(null),[en,ec]=(0,a.useState)(!1),[ed,eo]=(0,a.useState)(null),[ex,em]=(0,a.useState)(null),[eu,eh]=(0,a.useState)(null),[ep,ef]=(0,a.useState)(!1),[eb,eg]=(0,a.useState)(null),[ej,eN]=(0,a.useState)(!1),[ey,ev]=(0,a.useState)(m),[ek,ew]=(0,a.useState)(u),[eC,eA]=(0,a.useState)(!1),[eS,eL]=(0,a.useState)(!1),[eM,eE]=(0,a.useState)(p),[eP,eT]=(0,a.useState)(f),[e$,eI]=(0,a.useState)(b),[eW,eO]=(0,a.useState)(g),ez=(0,a.useCallback)(async()=>{try{let s=await fetch(`/api/members?baniId=${e}`),a=await s.json();q(a);let t=new Set;a.forEach(e=>{e.generation<=1&&t.add(e.id)}),ee(t)}catch(e){console.error("Failed to fetch:",e)}finally{Q(!1)}},[e]);(0,a.useEffect)(()=>{ez()},[ez]);let eR=function(e,s){let a;if(0===e.length)return null;let t=new Map;return e.forEach(e=>t.set(e.id,e)),a||(a=e.find(e=>0===e.generation)),a||(a=e.reduce((e,s)=>e.generation<s.generation?e:s)),function s(a){let t=e.filter(e=>e.fatherId===a.id||e.motherId===a.id).filter((e,s,a)=>a.findIndex(s=>s.id===e.id)===s).sort((e,s)=>e.fullName.localeCompare(s.fullName));return{...a,children:t.map(e=>s(e))}}(a)}(J),eD=(0,a.useCallback)(e=>{ee(s=>{let a=new Set(s);return a.has(e)?a.delete(e):a.add(e),a})},[]),eH=es?J.find(e=>e.id===es):null,eF=()=>er(e=>Math.min(e+.1,2)),eB=()=>er(e=>Math.max(e-.1,.3)),eV=()=>er(1),eU=(0,a.useCallback)(()=>{el.current&&(document.fullscreenElement?document.exitFullscreen():el.current.requestFullscreen().catch(e=>{console.error("Fullscreen error:",e)}))},[]);(0,a.useEffect)(()=>{let e=()=>{ec(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",e),()=>document.removeEventListener("fullscreenchange",e)},[]);let eK=(0,a.useRef)(et);eK.current=et;let eZ=(0,a.useRef)(new Map),eG=(0,a.useRef)(0),eX=(0,a.useRef)(1),eJ=(0,a.useCallback)(e=>{if(eZ.current.set(e.pointerId,{x:e.clientX,y:e.clientY}),e.target.setPointerCapture?.(e.pointerId),2===eZ.current.size){let e=Array.from(eZ.current.values()),s=e[0].x-e[1].x,a=e[0].y-e[1].y;eG.current=Math.sqrt(s*s+a*a),eX.current=eK.current}},[]),eq=(0,a.useCallback)(e=>{if(eZ.current.has(e.pointerId)&&(eZ.current.set(e.pointerId,{x:e.clientX,y:e.clientY}),2===eZ.current.size&&eG.current>0)){e.preventDefault();let s=Array.from(eZ.current.values()),a=s[0].x-s[1].x,t=s[0].y-s[1].y,r=Math.sqrt(a*a+t*t)/eG.current;er(Math.round(100*Math.min(Math.max(eX.current*r,.2),3))/100)}},[]),e_=(0,a.useCallback)(e=>{eZ.current.delete(e.pointerId),eZ.current.size<2&&(eG.current=0)},[]),eQ=(0,a.useCallback)((e,s)=>{eo({type:s,member:e})},[]),eY=(0,a.useCallback)(e=>{em(e)},[]),e0=(0,a.useCallback)(e=>{ex&&(eQ(ex,e),em(null))},[ex,eQ]),e1=(0,a.useCallback)(()=>{eo(null),ez()},[ez]),e2=(0,a.useCallback)(()=>{ez(),window.location.reload()},[ez]),e5=(0,a.useCallback)(async(s,a,t)=>{eA(!0);try{await fetch(`/api/banis/${e}/settings`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({treeOrientation:s,isPublic:a,...t})}),ev(s),ew(a),t?.showWaPublic!==void 0&&eE(t.showWaPublic),t?.showBirthPublic!==void 0&&eT(t.showBirthPublic),t?.showAddressPublic!==void 0&&eI(t.showAddressPublic),t?.showSocmedPublic!==void 0&&eO(t.showSocmedPublic)}catch(e){console.error("Save settings error:",e)}finally{eA(!1)}},[e]),e4=`${window.location.origin}/tree/${e}`,e3=(0,a.useCallback)(async()=>{try{if(navigator.clipboard&&window.isSecureContext)await navigator.clipboard.writeText(e4);else{let e=document.createElement("textarea");e.value=e4,e.style.position="fixed",e.style.left="-9999px",e.style.top="-9999px",document.body.appendChild(e),e.focus(),e.select(),document.execCommand("copy"),document.body.removeChild(e)}eL(!0),setTimeout(()=>eL(!1),2e3)}catch{window.prompt("Salin link ini:",e4)}},[e4]);return(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)("div",{className:"flex rounded-xl bg-surface-100 p-1 flex-1",children:[(0,s.jsxs)("button",{onClick:()=>F("tree"),className:`flex-1 flex items-center justify-center gap-2 px-3 py-2 rounded-lg text-sm font-medium transition-all ${"tree"===S?"bg-white text-primary-700 shadow-sm":"text-surface-500 hover:text-surface-700"}`,children:[(0,s.jsx)(v.TreePine,{className:"w-4 h-4"}),"Pohon Nasab"]}),(0,s.jsxs)("button",{onClick:()=>F("list"),className:`flex-1 flex items-center justify-center gap-2 px-3 py-2 rounded-lg text-sm font-medium transition-all ${"list"===S?"bg-white text-primary-700 shadow-sm":"text-surface-500 hover:text-surface-700"}`,children:[(0,s.jsx)(k.List,{className:"w-4 h-4"}),"Daftar (",o.length,")"]})]}),x&&(0,s.jsx)("button",{onClick:()=>eN(!0),className:"p-2.5 rounded-xl bg-white border border-surface-200 shadow-sm hover:bg-surface-50 active:bg-surface-100 transition-colors",title:"Pengaturan",children:(0,s.jsx)(L.Settings,{className:"w-4 h-4 text-surface-500"})}),"tree"===S&&(0,s.jsxs)("div",{className:"hidden sm:flex items-center gap-3 ml-auto",children:[(0,s.jsxs)("div",{className:"flex items-center bg-white rounded-xl border border-surface-200 shadow-sm overflow-hidden",children:[(0,s.jsx)("button",{onClick:eB,className:"p-2.5 hover:bg-surface-50 active:bg-surface-100 transition-colors",title:"Perkecil",children:(0,s.jsx)(r.ZoomOut,{className:"w-4 h-4 text-surface-500"})}),(0,s.jsx)("div",{className:"w-px h-5 bg-surface-200"}),(0,s.jsx)("button",{onClick:eV,className:"px-3 py-2 hover:bg-surface-50 active:bg-surface-100 transition-colors",title:"Reset zoom",children:(0,s.jsxs)("span",{className:"text-xs font-semibold text-primary-600 min-w-[2.5rem] text-center block",children:[Math.round(100*et),"%"]})}),(0,s.jsx)("div",{className:"w-px h-5 bg-surface-200"}),(0,s.jsx)("button",{onClick:eF,className:"p-2.5 hover:bg-surface-50 active:bg-surface-100 transition-colors",title:"Perbesar",children:(0,s.jsx)(t.ZoomIn,{className:"w-4 h-4 text-surface-500"})}),(0,s.jsx)("div",{className:"w-px h-5 bg-surface-200"}),(0,s.jsx)("button",{onClick:eU,className:"p-2.5 hover:bg-surface-50 active:bg-surface-100 transition-colors",title:en?"Keluar layar penuh":"Layar penuh",children:en?(0,s.jsx)(n,{className:"w-4 h-4 text-surface-500"}):(0,s.jsx)(l.Maximize2,{className:"w-4 h-4 text-surface-500"})})]}),(0,s.jsx)(z.default,{treeContainerRef:ei,baniName:i||"Pohon-Nasab"})]}),x&&"list"===S&&(0,s.jsxs)("button",{onClick:()=>ef(!0),className:"hidden sm:inline-flex ml-auto touch-target items-center gap-2 px-4 py-2 rounded-xl bg-primary-600 text-white font-medium text-sm hover:bg-primary-500 transition-colors shadow-md shadow-primary-600/20",children:[(0,s.jsx)(h.Plus,{className:"w-4 h-4"}),"Tambah"]})]}),x&&"list"===S&&(0,s.jsxs)("button",{onClick:()=>ef(!0),className:"sm:hidden inline-flex items-center justify-center gap-2 px-3 py-2 rounded-xl bg-primary-600 text-white font-medium text-xs hover:bg-primary-500 transition-colors shadow-md shadow-primary-600/20",children:[(0,s.jsx)(h.Plus,{className:"w-3.5 h-3.5"}),"Tambah Anggota"]})]}),"tree"===S?(0,s.jsx)(s.Fragment,{children:_?(0,s.jsx)("div",{className:"flex items-center justify-center min-h-[40vh] sm:min-h-[60vh]",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"w-10 h-10 sm:w-12 sm:h-12 border-4 border-primary-200 border-t-primary-600 rounded-full animate-spin mx-auto mb-3"}),(0,s.jsx)("p",{className:"text-surface-500 text-sm",children:"Memuat pohon nasab..."})]})}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"sm:hidden",children:(0,s.jsx)(z.default,{treeContainerRef:ei,baniName:i||"Pohon-Nasab"})}),(0,s.jsxs)("div",{ref:el,className:"relative overflow-auto rounded-xl sm:rounded-2xl bg-white border border-surface-200 min-h-[40vh] sm:min-h-[60vh] p-3 sm:p-8",style:{touchAction:"pan-x pan-y"},onPointerDown:eJ,onPointerMove:eq,onPointerUp:e_,onPointerCancel:e_,children:[(0,s.jsxs)("div",{className:"sm:hidden fixed bottom-20 right-3 z-30 flex flex-col gap-2",children:[(0,s.jsx)("button",{onClick:eF,className:"w-10 h-10 rounded-full bg-white border border-surface-200 shadow-lg flex items-center justify-center active:bg-surface-100 transition-colors",title:"Perbesar",children:(0,s.jsx)(t.ZoomIn,{className:"w-4 h-4 text-surface-600"})}),(0,s.jsx)("button",{onClick:eV,className:"w-10 h-10 rounded-full bg-white border border-surface-200 shadow-lg flex items-center justify-center active:bg-surface-100 transition-colors",title:"Reset zoom",children:(0,s.jsxs)("span",{className:"text-[10px] font-bold text-primary-600",children:[Math.round(100*et),"%"]})}),(0,s.jsx)("button",{onClick:eB,className:"w-10 h-10 rounded-full bg-white border border-surface-200 shadow-lg flex items-center justify-center active:bg-surface-100 transition-colors",title:"Perkecil",children:(0,s.jsx)(r.ZoomOut,{className:"w-4 h-4 text-surface-600"})}),(0,s.jsx)("button",{onClick:eU,className:"w-10 h-10 rounded-full bg-primary-600 shadow-lg shadow-primary-600/30 flex items-center justify-center active:bg-primary-500 transition-colors",title:en?"Keluar layar penuh":"Layar penuh",children:en?(0,s.jsx)(n,{className:"w-4 h-4 text-white"}):(0,s.jsx)(l.Maximize2,{className:"w-4 h-4 text-white"})})]}),(0,s.jsx)("div",{ref:ei,className:"min-w-fit",children:(0,s.jsx)("div",{style:{transform:`scale(${et})`,transformOrigin:"top left"},className:"flex justify-center min-w-fit",children:eR?(0,s.jsx)(U,{node:eR,level:0,expanded:Y,toggleExpand:eD,selectedId:es,onSelect:ea,onShowQuickMenu:eY,canEdit:x,orientation:ey}):(0,s.jsx)("div",{className:"text-center py-20",children:(0,s.jsx)("p",{className:"text-surface-500",children:"Belum ada anggota di pohon ini"})})})})]}),eH&&(N=e=>{if(!e)return null;try{return new Date(e).toLocaleDateString("id-ID",{day:"numeric",month:"long",year:"numeric"})}catch{return e}},y=[],(eH.birthPlace||eH.birthDate)&&y.push([eH.birthPlace,N(eH.birthDate)].filter(Boolean).join(", ")),eH.city&&y.push(eH.city),eH.deathDate&&y.push("Wafat "+N(eH.deathDate)),(0,s.jsxs)("div",{className:"flex items-center gap-3 px-3 py-2.5 rounded-xl border border-surface-200 bg-white shadow-sm animate-scale-in",children:[(0,s.jsx)("div",{className:`w-9 h-9 rounded-full flex items-center justify-center flex-shrink-0 ${"MALE"===eH.gender?"bg-blue-100 text-blue-600":"bg-pink-100 text-pink-600"}`,children:eH.photo?(0,s.jsx)("img",{src:eH.photo,alt:eH.fullName,className:"w-9 h-9 rounded-full object-cover"}):(0,s.jsx)(d.User,{className:"w-4 h-4"})}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsxs)("div",{className:"flex items-center gap-1.5 flex-wrap",children:[(0,s.jsx)("span",{className:"font-semibold text-sm text-surface-900 truncate",children:eH.fullName}),eH.nickname&&(0,s.jsxs)("span",{className:"text-xs text-surface-400 truncate",children:["â€œ",eH.nickname,"â€"]}),!eH.isAlive&&(0,s.jsxs)("span",{className:"text-[10px] bg-surface-100 text-surface-400 px-1 py-0.5 rounded",children:["Alm","FEMALE"===eH.gender?"h":"","."]}),(0,s.jsxs)("span",{className:"text-[10px] text-surface-400 bg-surface-50 px-1.5 py-0.5 rounded",children:["Gen ",eH.generation]})]}),y.length>0&&(0,s.jsx)("p",{className:"text-[11px] text-surface-400 truncate mt-0.5",children:y.join(" Â· ")})]}),(0,s.jsxs)("div",{className:"flex items-center gap-1 flex-shrink-0",children:[eH.phoneWhatsapp&&(0,s.jsx)("a",{href:(0,O.getWhatsAppLink)(eH.phoneWhatsapp),target:"_blank",rel:"noopener noreferrer",className:"w-7 h-7 rounded-lg bg-green-500 text-white flex items-center justify-center hover:bg-green-400 transition-colors",title:"WhatsApp",children:(0,s.jsx)(c.Phone,{className:"w-3 h-3"})}),(C=eH.socialMedia)?Object.entries(C).filter(([,e])=>e).map(([e])=>{let a=R.find(s=>s.key===e);return a?(0,s.jsx)("a",{href:D(e,C[e]),target:"_blank",rel:"noopener noreferrer",className:`w-7 h-7 rounded-lg ${a.bg} ${a.color} flex items-center justify-center hover:opacity-80 transition-opacity`,title:`${a.label}: ${C[e]}`,children:(0,s.jsx)(H,{platform:e,className:"w-3 h-3"})},e):null}):null,x&&(0,s.jsx)("button",{onClick:()=>eg(eH.id),className:"w-7 h-7 rounded-lg border border-surface-200 text-surface-500 flex items-center justify-center hover:bg-surface-50 transition-colors",title:"Edit",children:(0,s.jsx)(A,{className:"w-3 h-3"})}),(0,s.jsx)("button",{onClick:()=>ea(null),className:"w-7 h-7 rounded-lg border border-surface-200 text-surface-400 flex items-center justify-center hover:bg-surface-50 transition-colors",title:"Tutup",children:(0,s.jsx)(j.X,{className:"w-3 h-3"})})]})]}))]})}):(0,s.jsx)(K,{members:o,baniId:e,onSelectMember:eh}),ex&&(0,s.jsx)(B,{node:ex,onSelect:e0,onClose:()=>em(null)}),ed&&(0,s.jsx)(V,{context:ed,allMembers:J,baniId:e,onClose:()=>eo(null),onSuccess:e1}),eu&&(0,s.jsx)(Z,{member:eu,baniId:e,onClose:()=>eh(null),onEdit:e=>eg(e)}),eb&&(0,s.jsx)(X,{memberId:eb,baniId:e,allMembers:o,onClose:()=>eg(null),onSuccess:()=>{eg(null),ez(),window.location.reload()}}),ep&&(0,s.jsx)(G,{baniId:e,existingMembers:o,onClose:()=>ef(!1),onSuccess:e2}),ej&&(0,s.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[(0,s.jsx)("div",{className:"fixed inset-0 bg-black/40 backdrop-blur-sm",onClick:()=>eN(!1)}),(0,s.jsxs)("div",{className:"relative bg-white rounded-2xl shadow-2xl w-full max-w-sm animate-scale-in",children:[(0,s.jsxs)("div",{className:"px-6 py-4 border-b border-surface-100 flex items-center justify-between",children:[(0,s.jsxs)("h2",{className:"text-lg font-bold text-surface-900 flex items-center gap-2",children:[(0,s.jsx)(L.Settings,{className:"w-5 h-5 text-primary-600"})," Pengaturan Tree"]}),(0,s.jsx)("button",{onClick:()=>eN(!1),className:"p-1.5 rounded-lg hover:bg-surface-100 transition-colors",children:(0,s.jsx)(j.X,{className:"w-5 h-5 text-surface-400"})})]}),(0,s.jsxs)("div",{className:"p-6 space-y-5",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"text-xs font-semibold text-surface-500 uppercase tracking-wider mb-3 block flex items-center gap-1.5",children:[(0,s.jsx)($,{className:"w-3.5 h-3.5"})," Orientasi Pohon"]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,s.jsx)("button",{onClick:()=>e5("VERTICAL",ek),disabled:eC,className:`p-4 rounded-xl border-2 transition-all text-center ${"VERTICAL"===ey?"border-primary-500 bg-primary-50":"border-surface-200 hover:border-surface-300"}`,children:(0,s.jsxs)("div",{className:"flex flex-col items-center gap-2",children:[(0,s.jsxs)("svg",{className:"w-8 h-8",viewBox:"0 0 32 32",fill:"none",children:[(0,s.jsx)("circle",{cx:"16",cy:"4",r:"3",className:"VERTICAL"===ey?"fill-primary-500":"fill-surface-300"}),(0,s.jsx)("line",{x1:"16",y1:"7",x2:"16",y2:"16",className:"VERTICAL"===ey?"stroke-primary-400":"stroke-surface-300",strokeWidth:"2"}),(0,s.jsx)("line",{x1:"8",y1:"16",x2:"24",y2:"16",className:"VERTICAL"===ey?"stroke-primary-400":"stroke-surface-300",strokeWidth:"2"}),(0,s.jsx)("line",{x1:"8",y1:"16",x2:"8",y2:"22",className:"VERTICAL"===ey?"stroke-primary-400":"stroke-surface-300",strokeWidth:"2"}),(0,s.jsx)("line",{x1:"24",y1:"16",x2:"24",y2:"22",className:"VERTICAL"===ey?"stroke-primary-400":"stroke-surface-300",strokeWidth:"2"}),(0,s.jsx)("circle",{cx:"8",cy:"25",r:"3",className:"VERTICAL"===ey?"fill-primary-400":"fill-surface-300"}),(0,s.jsx)("circle",{cx:"24",cy:"25",r:"3",className:"VERTICAL"===ey?"fill-primary-400":"fill-surface-300"})]}),(0,s.jsx)("span",{className:`text-xs font-medium ${"VERTICAL"===ey?"text-primary-700":"text-surface-500"}`,children:"Vertikal"})]})}),(0,s.jsx)("button",{onClick:()=>e5("HORIZONTAL",ek),disabled:eC,className:`p-4 rounded-xl border-2 transition-all text-center ${"HORIZONTAL"===ey?"border-primary-500 bg-primary-50":"border-surface-200 hover:border-surface-300"}`,children:(0,s.jsxs)("div",{className:"flex flex-col items-center gap-2",children:[(0,s.jsxs)("svg",{className:"w-8 h-8",viewBox:"0 0 32 32",fill:"none",children:[(0,s.jsx)("circle",{cx:"4",cy:"16",r:"3",className:"HORIZONTAL"===ey?"fill-primary-500":"fill-surface-300"}),(0,s.jsx)("line",{x1:"7",y1:"16",x2:"16",y2:"16",className:"HORIZONTAL"===ey?"stroke-primary-400":"stroke-surface-300",strokeWidth:"2"}),(0,s.jsx)("line",{x1:"16",y1:"8",x2:"16",y2:"24",className:"HORIZONTAL"===ey?"stroke-primary-400":"stroke-surface-300",strokeWidth:"2"}),(0,s.jsx)("line",{x1:"16",y1:"8",x2:"22",y2:"8",className:"HORIZONTAL"===ey?"stroke-primary-400":"stroke-surface-300",strokeWidth:"2"}),(0,s.jsx)("line",{x1:"16",y1:"24",x2:"22",y2:"24",className:"HORIZONTAL"===ey?"stroke-primary-400":"stroke-surface-300",strokeWidth:"2"}),(0,s.jsx)("circle",{cx:"25",cy:"8",r:"3",className:"HORIZONTAL"===ey?"fill-primary-400":"fill-surface-300"}),(0,s.jsx)("circle",{cx:"25",cy:"24",r:"3",className:"HORIZONTAL"===ey?"fill-primary-400":"fill-surface-300"})]}),(0,s.jsx)("span",{className:`text-xs font-medium ${"HORIZONTAL"===ey?"text-primary-700":"text-surface-500"}`,children:"Horizontal"})]})})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"text-xs font-semibold text-surface-500 uppercase tracking-wider mb-3 block flex items-center gap-1.5",children:[ek?(0,s.jsx)(M,{className:"w-3.5 h-3.5"}):(0,s.jsx)(E.Lock,{className:"w-3.5 h-3.5"})," Visibilitas"]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("button",{onClick:()=>e5(ey,!1),disabled:eC,className:`w-full flex items-center gap-3 p-3 rounded-xl border-2 transition-all text-left ${!ek?"border-primary-500 bg-primary-50":"border-surface-200 hover:border-surface-300"}`,children:[(0,s.jsx)(E.Lock,{className:`w-5 h-5 ${!ek?"text-primary-600":"text-surface-300"}`}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:`text-sm font-medium ${!ek?"text-primary-700":"text-surface-600"}`,children:"Privat"}),(0,s.jsx)("p",{className:"text-[11px] text-surface-400",children:"Hanya anggota yang bisa melihat"})]})]}),(0,s.jsxs)("button",{onClick:()=>e5(ey,!0),disabled:eC,className:`w-full flex items-center gap-3 p-3 rounded-xl border-2 transition-all text-left ${ek?"border-green-500 bg-green-50":"border-surface-200 hover:border-surface-300"}`,children:[(0,s.jsx)(M,{className:`w-5 h-5 ${ek?"text-green-600":"text-surface-300"}`}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:`text-sm font-medium ${ek?"text-green-700":"text-surface-600"}`,children:"Publik"}),(0,s.jsx)("p",{className:"text-[11px] text-surface-400",children:"Siapapun dengan link bisa melihat pohon"})]})]})]}),ek&&(0,s.jsxs)("div",{className:"mt-3 p-3 rounded-lg bg-green-50 border border-green-200",children:[(0,s.jsx)("p",{className:"text-[11px] text-green-700 font-medium mb-2",children:"Link Publik:"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("input",{type:"text",readOnly:!0,value:e4,className:"flex-1 px-2.5 py-1.5 rounded-lg bg-white border border-green-200 text-xs text-surface-700 truncate"}),(0,s.jsxs)("button",{onClick:e3,className:"flex items-center gap-1 px-3 py-1.5 rounded-lg bg-green-600 text-white text-xs font-medium hover:bg-green-500 transition-colors flex-shrink-0",children:[eS?(0,s.jsx)(T,{className:"w-3.5 h-3.5"}):(0,s.jsx)(P,{className:"w-3.5 h-3.5"}),eS?"Tersalin!":"Salin"]})]})]}),ek&&(0,s.jsxs)("div",{className:"mt-4 pt-4 border-t border-surface-200",children:[(0,s.jsx)("label",{className:"text-xs font-semibold text-surface-500 uppercase tracking-wider mb-3 block",children:"Data Ditampilkan di Publik"}),(0,s.jsx)("div",{className:"space-y-2",children:[{key:"showWaPublic",label:"Nomor WhatsApp",value:eM,iconComponent:(0,s.jsx)(I.Smartphone,{className:"w-4 h-4 text-green-500"}),iconBg:"bg-green-50"},{key:"showBirthPublic",label:"Tanggal Lahir",value:eP,iconComponent:(0,s.jsx)(W,{className:"w-4 h-4 text-blue-500"}),iconBg:"bg-blue-50"},{key:"showAddressPublic",label:"Alamat",value:e$,iconComponent:(0,s.jsx)(w,{className:"w-4 h-4 text-red-500"}),iconBg:"bg-red-50"},{key:"showSocmedPublic",label:"Sosial Media",value:eW,iconComponent:(0,s.jsx)(M,{className:"w-4 h-4 text-purple-500"}),iconBg:"bg-purple-50"}].map(e=>(0,s.jsxs)("button",{onClick:()=>e5(ey,!0,{[e.key]:!e.value}),disabled:eC,className:"w-full flex items-center justify-between p-2.5 rounded-lg border border-surface-200 hover:bg-surface-50 transition-all",children:[(0,s.jsxs)("span",{className:"flex items-center gap-2.5 text-sm text-surface-700",children:[(0,s.jsx)("span",{className:`w-7 h-7 rounded-lg ${e.iconBg} flex items-center justify-center flex-shrink-0`,children:e.iconComponent}),(0,s.jsx)("span",{className:"font-medium",children:e.label})]}),(0,s.jsx)("div",{className:`w-9 h-5 rounded-full transition-colors relative ${e.value?"bg-green-500":"bg-surface-300"}`,children:(0,s.jsx)("div",{className:`absolute top-0.5 w-4 h-4 rounded-full bg-white shadow transition-transform ${e.value?"translate-x-4":"translate-x-0.5"}`})})]},e.key))})]})]}),eC&&(0,s.jsx)("p",{className:"text-xs text-primary-500 text-center animate-pulse",children:"Menyimpan..."})]})]})]})]})}e.s(["default",()=>J],62645)}]);