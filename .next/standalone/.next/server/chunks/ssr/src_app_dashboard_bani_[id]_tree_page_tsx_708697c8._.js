module.exports=[97481,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(38246),e=a.i(210),f=a.i(61690),g=a.i(69602),h=a.i(34044),i=a.i(63519),j=a.i(46842),k=a.i(5784),l=a.i(67552),m=a.i(52495),n=a.i(70106);let o=(0,n.default)("network",[["rect",{x:"16",y:"16",width:"6",height:"6",rx:"1",key:"4q2zg0"}],["rect",{x:"2",y:"16",width:"6",height:"6",rx:"1",key:"8cvhb9"}],["rect",{x:"9",y:"2",width:"6",height:"6",rx:"1",key:"1egb70"}],["path",{d:"M5 16v-3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3",key:"1jsf9p"}],["path",{d:"M12 12V8",key:"2874zd"}]]);var p=a.i(67329),q=a.i(15618),r=a.i(70255),s=a.i(76472),t=a.i(60246),u=a.i(96221),v=a.i(33508),w=a.i(68114),x=a.i(2549),y=a.i(50522),z=a.i(13749);let A=(0,n.default)("layers",[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]]);function B({members:a,baniId:e}){let[f,g]=(0,c.useState)(0),[h,k]=(0,c.useState)(null),l=(0,c.useMemo)(()=>Math.max(...a.map(a=>a.generation),0),[a]),m=Array.from({length:l+1},(a,b)=>b),n=(0,c.useMemo)(()=>{let b=a.filter(a=>a.generation===f);return h&&f>0&&(b=b.filter(a=>a.fatherId===h||a.motherId===h)),b.sort((a,b)=>a.fullName.localeCompare(b.fullName))},[a,f,h]),o=h?a.find(a=>a.id===h)?.fullName:null;return(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("div",{className:"flex items-center gap-2 overflow-x-auto pb-2 scrollbar-hide",children:m.map(a=>(0,b.jsxs)("button",{onClick:()=>{g(a),k(null)},className:`flex-shrink-0 px-4 py-2.5 rounded-xl text-sm font-medium transition-all ${f===a?"bg-primary-600 text-white shadow-md shadow-primary-600/20":"bg-white border border-surface-200 text-surface-600 hover:bg-surface-50"}`,children:["Gen ",a+1]},a))}),(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)(A,{className:"w-4 h-4 text-surface-400"}),(0,b.jsxs)("span",{className:"text-surface-500",children:["Generasi ",f+1]}),o&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(y.ChevronRight,{className:"w-3 h-3 text-surface-300"}),(0,b.jsx)("span",{className:"text-primary-600 font-medium",children:o})]}),(h||f>0)&&(0,b.jsxs)("button",{onClick:()=>{if(h&&f>0){let b=a.find(a=>a.id===h);b&&(g(f-1),k(b.fatherId||b.motherId||null))}else g(Math.max(0,f-1)),k(null)},className:"ml-auto flex items-center gap-1 px-3 py-1.5 rounded-lg text-xs text-surface-600 bg-surface-100 hover:bg-surface-200 transition-colors",children:[(0,b.jsx)(z.ChevronLeft,{className:"w-3 h-3"}),"Kembali"]})]}),(0,b.jsx)("div",{className:"space-y-3",children:0===n.length?(0,b.jsxs)("div",{className:"text-center py-12 rounded-2xl bg-white border border-surface-200",children:[(0,b.jsx)(j.User,{className:"w-10 h-10 text-surface-300 mx-auto mb-3"}),(0,b.jsx)("p",{className:"text-surface-500 text-sm",children:"Tidak ada anggota di generasi ini"})]}):n.map(c=>{let h=a.filter(a=>a.generation===f+1&&(a.fatherId===c.id||a.motherId===c.id)).length;return(0,b.jsxs)("div",{className:"rounded-2xl bg-white border border-surface-200 overflow-hidden hover:shadow-md transition-all",children:[(0,b.jsxs)("div",{className:"p-4 flex items-center gap-3",children:[(0,b.jsx)("div",{className:`w-14 h-14 rounded-xl flex items-center justify-center flex-shrink-0 ${"MALE"===c.gender?"bg-blue-50 text-blue-600":"bg-pink-50 text-pink-600"} ${!c.isAlive?"opacity-60":""}`,children:c.photo?(0,b.jsx)("img",{src:c.photo,alt:c.fullName,className:"w-14 h-14 rounded-xl object-cover"}):(0,b.jsx)(j.User,{className:"w-7 h-7"})}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("p",{className:"font-semibold text-surface-900 truncate",children:c.fullName}),!c.isAlive&&(0,b.jsx)("span",{className:"text-xs px-1.5 py-0.5 rounded bg-surface-100 text-surface-500 flex-shrink-0",children:"Alm."})]}),c.nickname&&(0,b.jsx)("p",{className:"text-xs text-surface-400",children:c.nickname}),(0,b.jsxs)("div",{className:"flex items-center gap-3 mt-1",children:[c.city&&(0,b.jsxs)("span",{className:"text-xs text-surface-400",children:["ðŸ“ ",c.city]}),h>0&&(0,b.jsxs)("span",{className:"text-xs text-primary-600 font-medium",children:[h," anak"]})]})]}),(0,b.jsx)("div",{className:"flex items-center gap-1 flex-shrink-0",children:c.phoneWhatsapp&&(0,b.jsx)("a",{href:(0,w.getWhatsAppLink)(c.phoneWhatsapp),target:"_blank",rel:"noopener noreferrer",className:"touch-target p-2 rounded-lg hover:bg-green-50 transition-colors",children:(0,b.jsx)(i.Phone,{className:"w-5 h-5 text-green-600"})})})]}),(0,b.jsxs)("div",{className:"flex border-t border-surface-100",children:[(0,b.jsx)(d.default,{href:`/dashboard/bani/${e}/members/${c.id}`,className:"flex-1 py-3 text-center text-xs font-medium text-primary-600 hover:bg-primary-50 transition-colors",children:"Detail"}),h>0&&(0,b.jsxs)("button",{onClick:()=>{var b;return b=c.id,void(f<l&&a.filter(a=>a.generation===f+1&&(a.fatherId===b||a.motherId===b)).length>0&&(k(b),g(f+1)))},className:"flex-1 py-3 text-center text-xs font-medium text-gold-600 hover:bg-gold-50 transition-colors border-l border-surface-100 flex items-center justify-center gap-1",children:["Lihat Anak",(0,b.jsx)(y.ChevronRight,{className:"w-3 h-3"})]})]})]},c.id)})}),(0,b.jsxs)("div",{className:"text-center text-xs text-surface-400 pt-2",children:[n.length," anggota di generasi ",f+1,o?` (keturunan ${o})`:""]})]})}function C({node:a,onSelect:c,onClose:d}){return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"fixed inset-0 z-40",onClick:d}),(0,b.jsxs)("div",{className:"absolute top-full left-0 mt-1 z-50 bg-white rounded-xl shadow-xl border border-surface-200 py-1.5 min-w-[180px] animate-fade-in",children:[(0,b.jsxs)("button",{onClick:()=>c("child"),className:"w-full flex items-center gap-3 px-4 py-2.5 text-sm text-surface-700 hover:bg-primary-50 hover:text-primary-700 transition-colors text-left",children:[(0,b.jsx)(r.Baby,{className:"w-4 h-4"}),"Tambah Anak"]}),(0,b.jsxs)("button",{onClick:()=>c("spouse"),className:"w-full flex items-center gap-3 px-4 py-2.5 text-sm text-surface-700 hover:bg-pink-50 hover:text-pink-700 transition-colors text-left",children:[(0,b.jsx)(s.Heart,{className:"w-4 h-4"}),"Tambah Pasangan"]}),(0,b.jsxs)("button",{onClick:()=>c("sibling"),className:"w-full flex items-center gap-3 px-4 py-2.5 text-sm text-surface-700 hover:bg-blue-50 hover:text-blue-700 transition-colors text-left",children:[(0,b.jsx)(t.Users,{className:"w-4 h-4"}),"Tambah Saudara"]})]})]})}function D({context:a,allMembers:d,baniId:e,onClose:f,onSuccess:g}){let[h,i]=(0,c.useState)(""),[j,k]=(0,c.useState)(""),[l,m]=(0,c.useState)("MALE"),[n,o]=(0,c.useState)(!0),[p,r]=(0,c.useState)(!1),[s,t]=(0,c.useState)(""),[w,x]=(0,c.useState)(""),{type:y,member:z}=a,A=[];"MALE"===z.gender&&z.marriagesAsHusband?z.marriagesAsHusband.forEach(a=>A.push(a.wife)):"FEMALE"===z.gender&&z.marriagesAsWife&&z.marriagesAsWife.forEach(a=>A.push(a.husband));let B=1===A.length,C=A.length>1;(0,c.useEffect)(()=>{"child"===y&&B&&x(A[0].id)},[y,B]);let D="child"===y?`Tambah Anak ${z.fullName}`:"spouse"===y?`Tambah Pasangan ${z.fullName}`:`Tambah Saudara ${z.fullName}`,E="child"===y?"Anggota baru akan menjadi anak dari orang ini":"spouse"===y?"Anggota baru akan menjadi pasangan orang ini":"Anggota baru akan memiliki orang tua yang sama";(0,c.useEffect)(()=>{"spouse"===y&&m("MALE"===z.gender?"FEMALE":"MALE")},[y,z.gender]);let F="child"===y?A.length>0?A.map(a=>({id:a.id,fullName:a.fullName,gender:a.gender,generation:0})):"MALE"===z.gender?d.filter(a=>"FEMALE"===a.gender):d.filter(a=>"MALE"===a.gender):[],G=async a=>{if(a.preventDefault(),h.trim()){r(!0),t("");try{let a,b;"child"===y?"MALE"===z.gender?(a=z.id,b=w||void 0):(b=z.id,a=w||void 0):"sibling"===y&&(a=z.fatherId||void 0,b=z.motherId||void 0);let c=await fetch("/api/members",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({baniId:e,fullName:h.trim(),nickname:j.trim()||void 0,gender:l,isAlive:n,fatherId:a,motherId:b})}),d=await c.json();if(!c.ok)return void t(d.error||"Gagal menyimpan");if("spouse"===y){let a="MALE"===z.gender?z.id:d.id,b="FEMALE"===z.gender?z.id:d.id;(await fetch("/api/marriages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({husbandId:a,wifeId:b})})).ok||console.error("Failed to create marriage, but member was created")}g()}catch{t("Terjadi kesalahan. Silakan coba lagi.")}finally{r(!1)}}};return(0,b.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[(0,b.jsx)("div",{className:"absolute inset-0 bg-black/40 backdrop-blur-sm",onClick:f}),(0,b.jsxs)("div",{className:"relative bg-white rounded-2xl shadow-2xl w-full max-w-md max-h-[90vh] overflow-y-auto animate-scale-in",children:[(0,b.jsxs)("div",{className:"sticky top-0 bg-white rounded-t-2xl border-b border-surface-100 p-5 flex items-start justify-between z-10",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"text-lg font-bold text-surface-900",children:D}),(0,b.jsx)("p",{className:"text-xs text-surface-400 mt-0.5",children:E})]}),(0,b.jsx)("button",{onClick:f,className:"p-1.5 rounded-lg hover:bg-surface-100 transition-colors text-surface-400",children:(0,b.jsx)(v.X,{className:"w-5 h-5"})})]}),(0,b.jsxs)("form",{onSubmit:G,className:"p-5 space-y-4",children:[s&&(0,b.jsx)("div",{className:"p-3 rounded-xl bg-red-50 border border-red-200 text-red-700 text-sm",children:s}),"child"===y&&(0,b.jsx)("div",{className:"p-3 rounded-xl bg-primary-50 border border-primary-100",children:(0,b.jsxs)("p",{className:"text-xs font-medium text-primary-700",children:["MALE"===z.gender?"ðŸ‘¨ Ayah":"ðŸ‘© Ibu",":"," ",(0,b.jsx)("span",{className:"font-bold",children:z.fullName})]})}),"sibling"===y&&(z.fatherId||z.motherId)&&(0,b.jsxs)("div",{className:"p-3 rounded-xl bg-blue-50 border border-blue-100 space-y-1",children:[(0,b.jsxs)("p",{className:"text-xs text-blue-600",children:["Orang tua yang sama dengan ",z.fullName,":"]}),z.fatherId&&(0,b.jsxs)("p",{className:"text-xs font-medium text-blue-700",children:["ðŸ‘¨ Ayah: ",d.find(a=>a.id===z.fatherId)?.fullName||"â€”"]}),z.motherId&&(0,b.jsxs)("p",{className:"text-xs font-medium text-blue-700",children:["ðŸ‘© Ibu: ",d.find(a=>a.id===z.motherId)?.fullName||"â€”"]})]}),"spouse"===y&&(0,b.jsx)("div",{className:"p-3 rounded-xl bg-pink-50 border border-pink-100",children:(0,b.jsxs)("p",{className:"text-xs font-medium text-pink-700",children:["ðŸ’‘ Pasangan dari: ",(0,b.jsx)("span",{className:"font-bold",children:z.fullName})]})}),"child"===y&&B&&(0,b.jsx)("div",{className:"p-3 rounded-xl bg-primary-50 border border-primary-100",children:(0,b.jsxs)("p",{className:"text-xs font-medium text-primary-700",children:["MALE"===z.gender?"ðŸ‘© Ibu":"ðŸ‘¨ Ayah",":"," ",(0,b.jsx)("span",{className:"font-bold",children:A[0].fullName})]})}),"child"===y&&C&&(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-surface-700 mb-1.5",children:"MALE"===z.gender?"Ibu":"Ayah"}),(0,b.jsxs)("select",{value:w,onChange:a=>x(a.target.value),className:"w-full px-3 py-2.5 rounded-xl border border-surface-200 text-sm text-surface-900 focus:outline-none focus:border-primary-500 bg-white",children:[(0,b.jsxs)("option",{value:"",children:["â€” Pilih ","MALE"===z.gender?"Ibu":"Ayah"," â€”"]}),F.map(a=>(0,b.jsx)("option",{value:a.id,children:a.fullName},a.id))]})]}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("label",{className:"block text-sm font-medium text-surface-700 mb-1.5",children:["Nama Lengkap ",(0,b.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,b.jsx)("input",{type:"text",value:h,onChange:a=>i(a.target.value),className:"w-full px-3 py-2.5 rounded-xl border border-surface-200 text-sm text-surface-900 placeholder-surface-400 focus:outline-none focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 transition-all",placeholder:"Nama lengkap",required:!0,autoFocus:!0})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-surface-700 mb-1.5",children:"Nama Panggilan"}),(0,b.jsx)("input",{type:"text",value:j,onChange:a=>k(a.target.value),className:"w-full px-3 py-2.5 rounded-xl border border-surface-200 text-sm text-surface-900 placeholder-surface-400 focus:outline-none focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 transition-all",placeholder:"Panggilan sehari-hari"})]}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("label",{className:"block text-sm font-medium text-surface-700 mb-1.5",children:["Jenis Kelamin ",(0,b.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)("button",{type:"button",onClick:()=>m("MALE"),className:`flex-1 py-2.5 rounded-xl border text-sm font-medium transition-all ${"MALE"===l?"border-blue-500 bg-blue-50 text-blue-700":"border-surface-200 text-surface-500 hover:bg-surface-50"}`,children:"ðŸ‘¨ Laki-laki"}),(0,b.jsx)("button",{type:"button",onClick:()=>m("FEMALE"),className:`flex-1 py-2.5 rounded-xl border text-sm font-medium transition-all ${"FEMALE"===l?"border-pink-500 bg-pink-50 text-pink-700":"border-surface-200 text-surface-500 hover:bg-surface-50"}`,children:"ðŸ‘© Perempuan"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-surface-700 mb-1.5",children:"Status"}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)("button",{type:"button",onClick:()=>o(!0),className:`flex-1 py-2.5 rounded-xl border text-sm font-medium transition-all ${n?"border-green-500 bg-green-50 text-green-700":"border-surface-200 text-surface-500 hover:bg-surface-50"}`,children:"â¤ï¸ Hidup"}),(0,b.jsx)("button",{type:"button",onClick:()=>o(!1),className:`flex-1 py-2.5 rounded-xl border text-sm font-medium transition-all ${!n?"border-surface-500 bg-surface-100 text-surface-700":"border-surface-200 text-surface-500 hover:bg-surface-50"}`,children:"ðŸ•Šï¸ Wafat"})]})]}),(0,b.jsxs)("div",{className:"flex gap-3 pt-2",children:[(0,b.jsx)("button",{type:"button",onClick:f,className:"flex-1 py-2.5 rounded-xl border border-surface-200 text-surface-600 font-medium text-sm hover:bg-surface-50 transition-colors",children:"Batal"}),(0,b.jsx)("button",{type:"submit",disabled:p||!h.trim(),className:"flex-1 py-2.5 rounded-xl bg-gradient-to-r from-primary-600 to-primary-700 text-white font-semibold text-sm hover:from-primary-500 hover:to-primary-600 transition-all shadow-lg shadow-primary-600/20 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:p?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(u.Loader2,{className:"w-4 h-4 animate-spin"}),"Menyimpan..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(q.Plus,{className:"w-4 h-4"}),"Simpan"]})})]})]})]})]})}function E({node:a,level:d,expanded:e,toggleExpand:f,selectedId:g,onSelect:h,onQuickAdd:m}){let n,[o,p]=(0,c.useState)(!1),r=e.has(a.id),s=a.children.length>0,t=g===a.id;return(0,b.jsxs)("div",{className:"flex flex-col items-center",children:[(0,b.jsxs)("div",{onClick:()=>h(a.id),className:`tree-node relative cursor-pointer rounded-2xl border-2 p-3 w-36 sm:w-44 text-center transition-all group ${t?"border-primary-500 bg-primary-50 shadow-lg shadow-primary-500/20":a.isAlive?"MALE"===a.gender?"border-blue-200 bg-white hover:border-blue-400":"border-pink-200 bg-white hover:border-pink-400":"border-surface-200 bg-surface-50 opacity-80 hover:opacity-100"}`,children:[(0,b.jsx)("div",{className:`w-12 h-12 rounded-full mx-auto mb-2 flex items-center justify-center ${"MALE"===a.gender?"bg-blue-100 text-blue-600":"bg-pink-100 text-pink-600"}`,children:a.photo?(0,b.jsx)("img",{src:a.photo,alt:a.fullName,className:"w-12 h-12 rounded-full object-cover"}):(0,b.jsx)(j.User,{className:"w-6 h-6"})}),(0,b.jsx)("p",{className:"text-xs sm:text-sm font-semibold text-surface-900 truncate",children:a.fullName}),a.nickname&&(0,b.jsxs)("p",{className:"text-[10px] text-surface-400 truncate",children:["(",a.nickname,")"]}),!a.isAlive&&(0,b.jsx)("span",{className:"inline-block text-[10px] px-1.5 py-0.5 rounded bg-surface-200 text-surface-500 mt-1",children:"Alm."}),(n=[],("MALE"===a.gender&&a.marriagesAsHusband?a.marriagesAsHusband.forEach(a=>n.push(a.wife.fullName)):"FEMALE"===a.gender&&a.marriagesAsWife&&a.marriagesAsWife.forEach(a=>n.push(a.husband.fullName)),0===n.length)?null:(0,b.jsx)("div",{className:"mt-1.5 space-y-0.5",children:n.map((c,d)=>(0,b.jsxs)("p",{className:`text-[9px] sm:text-[10px] truncate px-1.5 py-0.5 rounded-full ${"MALE"===a.gender?"bg-pink-50 text-pink-500":"bg-blue-50 text-blue-500"}`,children:["ðŸ’‘ ",c]},d))})),a.phoneWhatsapp&&a.isAlive&&(0,b.jsx)("a",{href:(0,w.getWhatsAppLink)(a.phoneWhatsapp),target:"_blank",rel:"noopener noreferrer",onClick:a=>a.stopPropagation(),className:"absolute -top-2 -right-2 w-7 h-7 rounded-full bg-green-500 text-white flex items-center justify-center shadow-md hover:bg-green-400 transition-colors",children:(0,b.jsx)(i.Phone,{className:"w-3.5 h-3.5"})}),(0,b.jsxs)("div",{className:"absolute -top-2 -left-2 z-30",children:[(0,b.jsx)("button",{onClick:a=>{a.stopPropagation(),p(!o)},className:"w-7 h-7 rounded-full bg-emerald-500 text-white flex items-center justify-center shadow-md hover:bg-emerald-400 transition-all opacity-0 group-hover:opacity-100 focus:opacity-100 hover:scale-110",title:"Tambah keluarga",children:(0,b.jsx)(q.Plus,{className:"w-3.5 h-3.5"})}),o&&(0,b.jsx)(C,{node:a,onSelect:b=>{p(!1),m(a,b)},onClose:()=>p(!1)})]}),s&&(0,b.jsx)("button",{onClick:b=>{b.stopPropagation(),f(a.id)},className:"absolute -bottom-3 left-1/2 -translate-x-1/2 w-6 h-6 rounded-full bg-primary-500 text-white flex items-center justify-center shadow-md hover:bg-primary-400 transition-colors text-xs",children:r?(0,b.jsx)(l.ChevronUp,{className:"w-3.5 h-3.5"}):(0,b.jsx)(k.ChevronDown,{className:"w-3.5 h-3.5"})})]}),s&&r&&(0,b.jsxs)("div",{className:"flex flex-col items-center",children:[(0,b.jsx)("div",{className:"w-0.5 h-8 bg-gradient-to-b from-primary-300 to-primary-200"}),(0,b.jsx)("div",{className:"flex",children:a.children.map((c,i)=>(0,b.jsxs)("div",{className:"flex flex-col items-center relative",children:[a.children.length>1&&(0,b.jsxs)("div",{className:"flex w-full h-0.5",children:[(0,b.jsx)("div",{className:`flex-1 h-full ${0===i?"bg-transparent":"bg-primary-200"}`}),(0,b.jsx)("div",{className:`flex-1 h-full ${i===a.children.length-1?"bg-transparent":"bg-primary-200"}`})]}),(0,b.jsx)("div",{className:"w-0.5 h-6 bg-primary-200"}),(0,b.jsx)("div",{className:"px-2 sm:px-3",children:(0,b.jsx)(E,{node:c,level:d+1,expanded:e,toggleExpand:f,selectedId:g,onSelect:h,onQuickAdd:m})})]},c.id))})]})]})}function F({params:a}){let[k,l]=(0,c.useState)(""),[n,q]=(0,c.useState)(""),[r,s]=(0,c.useState)([]),[t,u]=(0,c.useState)(!0),[v,y]=(0,c.useState)(new Set),[z,A]=(0,c.useState)(null),[C,F]=(0,c.useState)(1),[G,H]=(0,c.useState)("tree"),I=(0,c.useRef)(null),J=(0,c.useRef)(null),[K,L]=(0,c.useState)(null);(0,c.useEffect)(()=>{a.then(a=>{l(a.id),M(a.id)})},[a]);let M=async a=>{try{let b=await fetch(`/api/members?baniId=${a}`),c=await b.json();s(c);let d=new Set;c.forEach(a=>{a.generation<=1&&d.add(a.id)}),y(d)}catch(a){console.error("Failed to fetch:",a)}finally{u(!1)}},N=function(a,b){let c;if(0===a.length)return null;let d=new Map;return a.forEach(a=>d.set(a.id,a)),c||(c=a.find(a=>0===a.generation)),c||(c=a.reduce((a,b)=>a.generation<b.generation?a:b)),function b(c){let d=a.filter(a=>a.fatherId===c.id||a.motherId===c.id).filter((a,b,c)=>c.findIndex(b=>b.id===a.id)===b).sort((a,b)=>a.fullName.localeCompare(b.fullName));return{...c,children:d.map(a=>b(a))}}(c)}(r),O=(0,c.useCallback)(a=>{y(b=>{let c=new Set(b);return c.has(a)?c.delete(a):c.add(a),c})},[]),P=z?r.find(a=>a.id===z):null,Q=(0,c.useCallback)((a,b)=>{L({type:b,member:a})},[]),R=(0,c.useCallback)(()=>{L(null),k&&M(k)},[k]);return t?(0,b.jsx)("div",{className:"flex items-center justify-center min-h-[60vh]",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"w-12 h-12 border-4 border-primary-200 border-t-primary-600 rounded-full animate-spin mx-auto mb-4"}),(0,b.jsx)("p",{className:"text-surface-500",children:"Memuat pohon nasab..."})]})}):(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)(d.default,{href:`/dashboard/bani/${k}`,className:"touch-target p-2 rounded-xl hover:bg-surface-100 transition-colors",children:(0,b.jsx)(e.ArrowLeft,{className:"w-5 h-5 text-surface-600"})}),(0,b.jsx)("h1",{className:"text-xl sm:text-2xl font-bold text-surface-900",children:"Pohon Nasab"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)("div",{className:"flex rounded-lg border border-surface-200 overflow-hidden",children:[(0,b.jsx)("button",{onClick:()=>H("tree"),className:`p-2 transition-colors ${"tree"===G?"bg-primary-50 text-primary-600":"text-surface-400 hover:bg-surface-50"}`,title:"Tampilan Pohon",children:(0,b.jsx)(o,{className:"w-4 h-4"})}),(0,b.jsx)("button",{onClick:()=>H("list"),className:`p-2 transition-colors ${"list"===G?"bg-primary-50 text-primary-600":"text-surface-400 hover:bg-surface-50"}`,title:"Tampilan Daftar",children:(0,b.jsx)(p.List,{className:"w-4 h-4"})})]}),"tree"===G&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("button",{onClick:()=>F(a=>Math.max(a-.1,.3)),className:"touch-target p-2 rounded-lg border border-surface-200 hover:bg-surface-100 transition-colors hidden sm:block",children:(0,b.jsx)(g.ZoomOut,{className:"w-4 h-4 text-surface-600"})}),(0,b.jsxs)("span",{className:"text-sm text-surface-500 min-w-[3rem] text-center hidden sm:block",children:[Math.round(100*C),"%"]}),(0,b.jsx)("button",{onClick:()=>F(a=>Math.min(a+.1,2)),className:"touch-target p-2 rounded-lg border border-surface-200 hover:bg-surface-100 transition-colors hidden sm:block",children:(0,b.jsx)(f.ZoomIn,{className:"w-4 h-4 text-surface-600"})}),(0,b.jsx)("button",{onClick:()=>F(1),className:"touch-target p-2 rounded-lg border border-surface-200 hover:bg-surface-100 transition-colors hidden sm:block",children:(0,b.jsx)(h.Maximize2,{className:"w-4 h-4 text-surface-600"})})]})]})]}),"list"===G?(0,b.jsx)(B,{members:r,baniId:k}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[(0,b.jsx)("button",{onClick:()=>{y(new Set(r.map(a=>a.id)))},className:"touch-target px-4 py-2 rounded-lg text-sm font-medium border border-surface-200 hover:bg-surface-100 text-surface-600 transition-colors",children:"Buka Semua"}),(0,b.jsx)("button",{onClick:()=>{y(new Set)},className:"touch-target px-4 py-2 rounded-lg text-sm font-medium border border-surface-200 hover:bg-surface-100 text-surface-600 transition-colors",children:"Tutup Semua"}),(0,b.jsx)("div",{className:"ml-auto",children:(0,b.jsx)(x.default,{treeContainerRef:J,baniName:n||"Pohon-Nasab"})})]}),(0,b.jsx)("div",{ref:I,className:"overflow-auto rounded-2xl bg-white border border-surface-200 min-h-[60vh] p-8",children:(0,b.jsx)("div",{ref:J,children:(0,b.jsx)("div",{style:{transform:`scale(${C})`,transformOrigin:"top center"},className:"inline-flex justify-center w-full transition-transform duration-200",children:N?(0,b.jsx)(E,{node:N,level:0,expanded:v,toggleExpand:O,selectedId:z,onSelect:A,onQuickAdd:Q}):(0,b.jsx)("div",{className:"text-center py-20",children:(0,b.jsx)("p",{className:"text-surface-500",children:"Belum ada anggota di pohon ini"})})})})}),P&&(0,b.jsx)("div",{className:"rounded-2xl bg-white border border-surface-200 p-6 animate-slide-up",children:(0,b.jsxs)("div",{className:"flex items-start gap-4",children:[(0,b.jsx)("div",{className:`w-16 h-16 rounded-full flex items-center justify-center ${"MALE"===P.gender?"bg-blue-100 text-blue-600":"bg-pink-100 text-pink-600"}`,children:(0,b.jsx)(j.User,{className:"w-8 h-8"})}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("h3",{className:"text-lg font-semibold text-surface-900",children:[P.fullName,!P.isAlive&&(0,b.jsx)("span",{className:"ml-2 text-sm font-normal text-surface-400",children:"(Almarhum/ah)"})]}),P.nickname&&(0,b.jsx)("p",{className:"text-sm text-surface-500",children:P.nickname}),(0,b.jsxs)("div",{className:"flex flex-wrap gap-3 mt-3",children:[(0,b.jsxs)("span",{className:"text-xs px-2 py-1 rounded-lg bg-surface-100 text-surface-600",children:["Generasi ",P.generation+1]}),(0,b.jsx)("span",{className:`text-xs px-2 py-1 rounded-lg ${"MALE"===P.gender?"bg-blue-50 text-blue-700":"bg-pink-50 text-pink-700"}`,children:"MALE"===P.gender?"Laki-laki":"Perempuan"}),P.city&&(0,b.jsxs)("span",{className:"text-xs px-2 py-1 rounded-lg bg-surface-100 text-surface-600",children:["ðŸ“ ",P.city]})]}),P.phoneWhatsapp&&(0,b.jsxs)("a",{href:(0,w.getWhatsAppLink)(P.phoneWhatsapp),target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 mt-3 px-4 py-2 rounded-lg bg-green-500 text-white text-sm font-medium hover:bg-green-400 transition-colors",children:[(0,b.jsx)(i.Phone,{className:"w-4 h-4"}),"Chat WhatsApp"]}),(0,b.jsxs)(d.default,{href:`/dashboard/bani/${k}/members/${P.id}`,className:"inline-flex items-center gap-2 mt-3 ml-2 px-4 py-2 rounded-lg border border-primary-200 text-primary-600 text-sm font-medium hover:bg-primary-50 transition-colors",children:[(0,b.jsx)(m.ExternalLink,{className:"w-4 h-4"}),"Lihat Detail"]})]})]})})]}),K&&(0,b.jsx)(D,{context:K,allMembers:r,baniId:k,onClose:()=>L(null),onSuccess:R})]})}a.s(["default",()=>F],97481)}];

//# sourceMappingURL=src_app_dashboard_bani_%5Bid%5D_tree_page_tsx_708697c8._.js.map