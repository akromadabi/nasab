(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5025],{31734:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>F});var t=a(95155),r=a(12115),l=a(98500),n=a.n(l),i=a(78390),o=a(7686),c=a(7810),d=a(33210),m=a(6296),x=a(51914),u=a(42869),h=a(85118),f=a(9921),p=a(66088),b=a(80723),g=a(69260),j=a(38194),N=a(69220),y=a(22651),v=a(24371),w=a(22164),k=a(40980),A=a(34868),E=a(33024),S=a(21362),C=a(41641);function M({members:e,baniId:s}){let[a,l]=(0,r.useState)(0),[i,o]=(0,r.useState)(null),c=(0,r.useMemo)(()=>Math.max(...e.map(e=>e.generation),0),[e]),d=Array.from({length:c+1},(e,s)=>s),m=(0,r.useMemo)(()=>{let s=e.filter(e=>e.generation===a);return i&&a>0&&(s=s.filter(e=>e.fatherId===i||e.motherId===i)),s.sort((e,s)=>e.fullName.localeCompare(s.fullName))},[e,a,i]),x=i?e.find(e=>e.id===i)?.fullName:null;return(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("div",{className:"flex items-center gap-2 overflow-x-auto pb-2 scrollbar-hide",children:d.map(e=>(0,t.jsxs)("button",{onClick:()=>{l(e),o(null)},className:`flex-shrink-0 px-4 py-2.5 rounded-xl text-sm font-medium transition-all ${a===e?"bg-primary-600 text-white shadow-md shadow-primary-600/20":"bg-white border border-surface-200 text-surface-600 hover:bg-surface-50"}`,children:["Gen ",e+1]},e))}),(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,t.jsx)(E.A,{className:"w-4 h-4 text-surface-400"}),(0,t.jsxs)("span",{className:"text-surface-500",children:["Generasi ",a+1]}),x&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(S.A,{className:"w-3 h-3 text-surface-300"}),(0,t.jsx)("span",{className:"text-primary-600 font-medium",children:x})]}),(i||a>0)&&(0,t.jsxs)("button",{onClick:()=>{if(i&&a>0){let s=e.find(e=>e.id===i);s&&(l(a-1),o(s.fatherId||s.motherId||null))}else l(Math.max(0,a-1)),o(null)},className:"ml-auto flex items-center gap-1 px-3 py-1.5 rounded-lg text-xs text-surface-600 bg-surface-100 hover:bg-surface-200 transition-colors",children:[(0,t.jsx)(C.A,{className:"w-3 h-3"}),"Kembali"]})]}),(0,t.jsx)("div",{className:"space-y-3",children:0===m.length?(0,t.jsxs)("div",{className:"text-center py-12 rounded-2xl bg-white border border-surface-200",children:[(0,t.jsx)(u.A,{className:"w-10 h-10 text-surface-300 mx-auto mb-3"}),(0,t.jsx)("p",{className:"text-surface-500 text-sm",children:"Tidak ada anggota di generasi ini"})]}):m.map(r=>{let i=e.filter(e=>e.generation===a+1&&(e.fatherId===r.id||e.motherId===r.id)).length;return(0,t.jsxs)("div",{className:"rounded-2xl bg-white border border-surface-200 overflow-hidden hover:shadow-md transition-all",children:[(0,t.jsxs)("div",{className:"p-4 flex items-center gap-3",children:[(0,t.jsx)("div",{className:`w-14 h-14 rounded-xl flex items-center justify-center flex-shrink-0 ${"MALE"===r.gender?"bg-blue-50 text-blue-600":"bg-pink-50 text-pink-600"} ${!r.isAlive?"opacity-60":""}`,children:r.photo?(0,t.jsx)("img",{src:r.photo,alt:r.fullName,className:"w-14 h-14 rounded-xl object-cover"}):(0,t.jsx)(u.A,{className:"w-7 h-7"})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("p",{className:"font-semibold text-surface-900 truncate",children:r.fullName}),!r.isAlive&&(0,t.jsx)("span",{className:"text-xs px-1.5 py-0.5 rounded bg-surface-100 text-surface-500 flex-shrink-0",children:"Alm."})]}),r.nickname&&(0,t.jsx)("p",{className:"text-xs text-surface-400",children:r.nickname}),(0,t.jsxs)("div",{className:"flex items-center gap-3 mt-1",children:[r.city&&(0,t.jsxs)("span",{className:"text-xs text-surface-400",children:["\uD83D\uDCCD ",r.city]}),i>0&&(0,t.jsxs)("span",{className:"text-xs text-primary-600 font-medium",children:[i," anak"]})]})]}),(0,t.jsx)("div",{className:"flex items-center gap-1 flex-shrink-0",children:r.phoneWhatsapp&&(0,t.jsx)("a",{href:(0,k.rr)(r.phoneWhatsapp),target:"_blank",rel:"noopener noreferrer",className:"touch-target p-2 rounded-lg hover:bg-green-50 transition-colors",children:(0,t.jsx)(h.A,{className:"w-5 h-5 text-green-600"})})})]}),(0,t.jsxs)("div",{className:"flex border-t border-surface-100",children:[(0,t.jsx)(n(),{href:`/dashboard/bani/${s}/members/${r.id}`,className:"flex-1 py-3 text-center text-xs font-medium text-primary-600 hover:bg-primary-50 transition-colors",children:"Detail"}),i>0&&(0,t.jsxs)("button",{onClick:()=>{var s;return s=r.id,void(a<c&&e.filter(e=>e.generation===a+1&&(e.fatherId===s||e.motherId===s)).length>0&&(o(s),l(a+1)))},className:"flex-1 py-3 text-center text-xs font-medium text-gold-600 hover:bg-gold-50 transition-colors border-l border-surface-100 flex items-center justify-center gap-1",children:["Lihat Anak",(0,t.jsx)(S.A,{className:"w-3 h-3"})]})]})]},r.id)})}),(0,t.jsxs)("div",{className:"text-center text-xs text-surface-400 pt-2",children:[m.length," anggota di generasi ",a+1,x?` (keturunan ${x})`:""]})]})}function L({node:e,onSelect:s,onClose:a}){return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"fixed inset-0 z-40",onClick:a}),(0,t.jsxs)("div",{className:"absolute top-full left-0 mt-1 z-50 bg-white rounded-xl shadow-xl border border-surface-200 py-1.5 min-w-[180px] animate-fade-in",children:[(0,t.jsxs)("button",{onClick:()=>s("child"),className:"w-full flex items-center gap-3 px-4 py-2.5 text-sm text-surface-700 hover:bg-primary-50 hover:text-primary-700 transition-colors text-left",children:[(0,t.jsx)(i.A,{className:"w-4 h-4"}),"Tambah Anak"]}),(0,t.jsxs)("button",{onClick:()=>s("spouse"),className:"w-full flex items-center gap-3 px-4 py-2.5 text-sm text-surface-700 hover:bg-pink-50 hover:text-pink-700 transition-colors text-left",children:[(0,t.jsx)(o.A,{className:"w-4 h-4"}),"Tambah Pasangan"]}),(0,t.jsxs)("button",{onClick:()=>s("sibling"),className:"w-full flex items-center gap-3 px-4 py-2.5 text-sm text-surface-700 hover:bg-blue-50 hover:text-blue-700 transition-colors text-left",children:[(0,t.jsx)(c.A,{className:"w-4 h-4"}),"Tambah Saudara"]})]})]})}function I({context:e,allMembers:s,baniId:a,onClose:l,onSuccess:n}){let[i,o]=(0,r.useState)(""),[c,u]=(0,r.useState)(""),[h,f]=(0,r.useState)("MALE"),[p,b]=(0,r.useState)(!0),[g,j]=(0,r.useState)(!1),[N,y]=(0,r.useState)(""),[v,w]=(0,r.useState)(""),{type:k,member:A}=e,E=[];"MALE"===A.gender&&A.marriagesAsHusband?A.marriagesAsHusband.forEach(e=>E.push(e.wife)):"FEMALE"===A.gender&&A.marriagesAsWife&&A.marriagesAsWife.forEach(e=>E.push(e.husband));let S=1===E.length,C=E.length>1;(0,r.useEffect)(()=>{"child"===k&&S&&w(E[0].id)},[k,S]);let M="child"===k?`Tambah Anak ${A.fullName}`:"spouse"===k?`Tambah Pasangan ${A.fullName}`:`Tambah Saudara ${A.fullName}`,L="child"===k?"Anggota baru akan menjadi anak dari orang ini":"spouse"===k?"Anggota baru akan menjadi pasangan orang ini":"Anggota baru akan memiliki orang tua yang sama";(0,r.useEffect)(()=>{"spouse"===k&&f("MALE"===A.gender?"FEMALE":"MALE")},[k,A.gender]);let I="child"===k?E.length>0?E.map(e=>({id:e.id,fullName:e.fullName,gender:e.gender,generation:0})):"MALE"===A.gender?s.filter(e=>"FEMALE"===e.gender):s.filter(e=>"MALE"===e.gender):[],$=async e=>{if(e.preventDefault(),i.trim()){j(!0),y("");try{let e,s;"child"===k?"MALE"===A.gender?(e=A.id,s=v||void 0):(s=A.id,e=v||void 0):"sibling"===k&&(e=A.fatherId||void 0,s=A.motherId||void 0);let t=await fetch("/api/members",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({baniId:a,fullName:i.trim(),nickname:c.trim()||void 0,gender:h,isAlive:p,fatherId:e,motherId:s})}),r=await t.json();if(!t.ok)return void y(r.error||"Gagal menyimpan");if("spouse"===k){let e="MALE"===A.gender?A.id:r.id,s="FEMALE"===A.gender?A.id:r.id;(await fetch("/api/marriages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({husbandId:e,wifeId:s})})).ok||console.error("Failed to create marriage, but member was created")}n()}catch{y("Terjadi kesalahan. Silakan coba lagi.")}finally{j(!1)}}};return(0,t.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-black/40 backdrop-blur-sm",onClick:l}),(0,t.jsxs)("div",{className:"relative bg-white rounded-2xl shadow-2xl w-full max-w-md max-h-[90vh] overflow-y-auto animate-scale-in",children:[(0,t.jsxs)("div",{className:"sticky top-0 bg-white rounded-t-2xl border-b border-surface-100 p-5 flex items-start justify-between z-10",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-lg font-bold text-surface-900",children:M}),(0,t.jsx)("p",{className:"text-xs text-surface-400 mt-0.5",children:L})]}),(0,t.jsx)("button",{onClick:l,className:"p-1.5 rounded-lg hover:bg-surface-100 transition-colors text-surface-400",children:(0,t.jsx)(d.A,{className:"w-5 h-5"})})]}),(0,t.jsxs)("form",{onSubmit:$,className:"p-5 space-y-4",children:[N&&(0,t.jsx)("div",{className:"p-3 rounded-xl bg-red-50 border border-red-200 text-red-700 text-sm",children:N}),"child"===k&&(0,t.jsx)("div",{className:"p-3 rounded-xl bg-primary-50 border border-primary-100",children:(0,t.jsxs)("p",{className:"text-xs font-medium text-primary-700",children:["MALE"===A.gender?"\uD83D\uDC68 Ayah":"\uD83D\uDC69 Ibu",":"," ",(0,t.jsx)("span",{className:"font-bold",children:A.fullName})]})}),"sibling"===k&&(A.fatherId||A.motherId)&&(0,t.jsxs)("div",{className:"p-3 rounded-xl bg-blue-50 border border-blue-100 space-y-1",children:[(0,t.jsxs)("p",{className:"text-xs text-blue-600",children:["Orang tua yang sama dengan ",A.fullName,":"]}),A.fatherId&&(0,t.jsxs)("p",{className:"text-xs font-medium text-blue-700",children:["\uD83D\uDC68 Ayah: ",s.find(e=>e.id===A.fatherId)?.fullName||"—"]}),A.motherId&&(0,t.jsxs)("p",{className:"text-xs font-medium text-blue-700",children:["\uD83D\uDC69 Ibu: ",s.find(e=>e.id===A.motherId)?.fullName||"—"]})]}),"spouse"===k&&(0,t.jsx)("div",{className:"p-3 rounded-xl bg-pink-50 border border-pink-100",children:(0,t.jsxs)("p",{className:"text-xs font-medium text-pink-700",children:["\uD83D\uDC91 Pasangan dari: ",(0,t.jsx)("span",{className:"font-bold",children:A.fullName})]})}),"child"===k&&S&&(0,t.jsx)("div",{className:"p-3 rounded-xl bg-primary-50 border border-primary-100",children:(0,t.jsxs)("p",{className:"text-xs font-medium text-primary-700",children:["MALE"===A.gender?"\uD83D\uDC69 Ibu":"\uD83D\uDC68 Ayah",":"," ",(0,t.jsx)("span",{className:"font-bold",children:E[0].fullName})]})}),"child"===k&&C&&(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-surface-700 mb-1.5",children:"MALE"===A.gender?"Ibu":"Ayah"}),(0,t.jsxs)("select",{value:v,onChange:e=>w(e.target.value),className:"w-full px-3 py-2.5 rounded-xl border border-surface-200 text-sm text-surface-900 focus:outline-none focus:border-primary-500 bg-white",children:[(0,t.jsxs)("option",{value:"",children:["— Pilih ","MALE"===A.gender?"Ibu":"Ayah"," —"]}),I.map(e=>(0,t.jsx)("option",{value:e.id,children:e.fullName},e.id))]})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("label",{className:"block text-sm font-medium text-surface-700 mb-1.5",children:["Nama Lengkap ",(0,t.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,t.jsx)("input",{type:"text",value:i,onChange:e=>o(e.target.value),className:"w-full px-3 py-2.5 rounded-xl border border-surface-200 text-sm text-surface-900 placeholder-surface-400 focus:outline-none focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 transition-all",placeholder:"Nama lengkap",required:!0,autoFocus:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-surface-700 mb-1.5",children:"Nama Panggilan"}),(0,t.jsx)("input",{type:"text",value:c,onChange:e=>u(e.target.value),className:"w-full px-3 py-2.5 rounded-xl border border-surface-200 text-sm text-surface-900 placeholder-surface-400 focus:outline-none focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 transition-all",placeholder:"Panggilan sehari-hari"})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("label",{className:"block text-sm font-medium text-surface-700 mb-1.5",children:["Jenis Kelamin ",(0,t.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{type:"button",onClick:()=>f("MALE"),className:`flex-1 py-2.5 rounded-xl border text-sm font-medium transition-all ${"MALE"===h?"border-blue-500 bg-blue-50 text-blue-700":"border-surface-200 text-surface-500 hover:bg-surface-50"}`,children:"\uD83D\uDC68 Laki-laki"}),(0,t.jsx)("button",{type:"button",onClick:()=>f("FEMALE"),className:`flex-1 py-2.5 rounded-xl border text-sm font-medium transition-all ${"FEMALE"===h?"border-pink-500 bg-pink-50 text-pink-700":"border-surface-200 text-surface-500 hover:bg-surface-50"}`,children:"\uD83D\uDC69 Perempuan"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-surface-700 mb-1.5",children:"Status"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{type:"button",onClick:()=>b(!0),className:`flex-1 py-2.5 rounded-xl border text-sm font-medium transition-all ${p?"border-green-500 bg-green-50 text-green-700":"border-surface-200 text-surface-500 hover:bg-surface-50"}`,children:"❤️ Hidup"}),(0,t.jsx)("button",{type:"button",onClick:()=>b(!1),className:`flex-1 py-2.5 rounded-xl border text-sm font-medium transition-all ${!p?"border-surface-500 bg-surface-100 text-surface-700":"border-surface-200 text-surface-500 hover:bg-surface-50"}`,children:"\uD83D\uDD4A️ Wafat"})]})]}),(0,t.jsxs)("div",{className:"flex gap-3 pt-2",children:[(0,t.jsx)("button",{type:"button",onClick:l,className:"flex-1 py-2.5 rounded-xl border border-surface-200 text-surface-600 font-medium text-sm hover:bg-surface-50 transition-colors",children:"Batal"}),(0,t.jsx)("button",{type:"submit",disabled:g||!i.trim(),className:"flex-1 py-2.5 rounded-xl bg-gradient-to-r from-primary-600 to-primary-700 text-white font-semibold text-sm hover:from-primary-500 hover:to-primary-600 transition-all shadow-lg shadow-primary-600/20 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:g?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(m.A,{className:"w-4 h-4 animate-spin"}),"Menyimpan..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(x.A,{className:"w-4 h-4"}),"Simpan"]})})]})]})]})]})}function $({node:e,level:s,expanded:a,toggleExpand:l,selectedId:n,onSelect:i,onQuickAdd:o}){let c,[d,m]=(0,r.useState)(!1),b=a.has(e.id),g=e.children.length>0,j=n===e.id;return(0,t.jsxs)("div",{className:"flex flex-col items-center",children:[(0,t.jsxs)("div",{onClick:()=>i(e.id),className:`tree-node relative cursor-pointer rounded-2xl border-2 p-3 w-36 sm:w-44 text-center transition-all group ${j?"border-primary-500 bg-primary-50 shadow-lg shadow-primary-500/20":e.isAlive?"MALE"===e.gender?"border-blue-200 bg-white hover:border-blue-400":"border-pink-200 bg-white hover:border-pink-400":"border-surface-200 bg-surface-50 opacity-80 hover:opacity-100"}`,children:[(0,t.jsx)("div",{className:`w-12 h-12 rounded-full mx-auto mb-2 flex items-center justify-center ${"MALE"===e.gender?"bg-blue-100 text-blue-600":"bg-pink-100 text-pink-600"}`,children:e.photo?(0,t.jsx)("img",{src:e.photo,alt:e.fullName,className:"w-12 h-12 rounded-full object-cover"}):(0,t.jsx)(u.A,{className:"w-6 h-6"})}),(0,t.jsx)("p",{className:"text-xs sm:text-sm font-semibold text-surface-900 truncate",children:e.fullName}),e.nickname&&(0,t.jsxs)("p",{className:"text-[10px] text-surface-400 truncate",children:["(",e.nickname,")"]}),!e.isAlive&&(0,t.jsx)("span",{className:"inline-block text-[10px] px-1.5 py-0.5 rounded bg-surface-200 text-surface-500 mt-1",children:"Alm."}),(c=[],("MALE"===e.gender&&e.marriagesAsHusband?e.marriagesAsHusband.forEach(e=>c.push(e.wife.fullName)):"FEMALE"===e.gender&&e.marriagesAsWife&&e.marriagesAsWife.forEach(e=>c.push(e.husband.fullName)),0===c.length)?null:(0,t.jsx)("div",{className:"mt-1.5 space-y-0.5",children:c.map((s,a)=>(0,t.jsxs)("p",{className:`text-[9px] sm:text-[10px] truncate px-1.5 py-0.5 rounded-full ${"MALE"===e.gender?"bg-pink-50 text-pink-500":"bg-blue-50 text-blue-500"}`,children:["\uD83D\uDC91 ",s]},a))})),e.phoneWhatsapp&&e.isAlive&&(0,t.jsx)("a",{href:(0,k.rr)(e.phoneWhatsapp),target:"_blank",rel:"noopener noreferrer",onClick:e=>e.stopPropagation(),className:"absolute -top-2 -right-2 w-7 h-7 rounded-full bg-green-500 text-white flex items-center justify-center shadow-md hover:bg-green-400 transition-colors",children:(0,t.jsx)(h.A,{className:"w-3.5 h-3.5"})}),(0,t.jsxs)("div",{className:"absolute -top-2 -left-2 z-30",children:[(0,t.jsx)("button",{onClick:e=>{e.stopPropagation(),m(!d)},className:"w-7 h-7 rounded-full bg-emerald-500 text-white flex items-center justify-center shadow-md hover:bg-emerald-400 transition-all opacity-0 group-hover:opacity-100 focus:opacity-100 hover:scale-110",title:"Tambah keluarga",children:(0,t.jsx)(x.A,{className:"w-3.5 h-3.5"})}),d&&(0,t.jsx)(L,{node:e,onSelect:s=>{m(!1),o(e,s)},onClose:()=>m(!1)})]}),g&&(0,t.jsx)("button",{onClick:s=>{s.stopPropagation(),l(e.id)},className:"absolute -bottom-3 left-1/2 -translate-x-1/2 w-6 h-6 rounded-full bg-primary-500 text-white flex items-center justify-center shadow-md hover:bg-primary-400 transition-colors text-xs",children:b?(0,t.jsx)(f.A,{className:"w-3.5 h-3.5"}):(0,t.jsx)(p.A,{className:"w-3.5 h-3.5"})})]}),g&&b&&(0,t.jsxs)("div",{className:"flex flex-col items-center",children:[(0,t.jsx)("div",{className:"w-0.5 h-8 bg-gradient-to-b from-primary-300 to-primary-200"}),(0,t.jsx)("div",{className:"flex",children:e.children.map((r,c)=>(0,t.jsxs)("div",{className:"flex flex-col items-center relative",children:[e.children.length>1&&(0,t.jsxs)("div",{className:"flex w-full h-0.5",children:[(0,t.jsx)("div",{className:`flex-1 h-full ${0===c?"bg-transparent":"bg-primary-200"}`}),(0,t.jsx)("div",{className:`flex-1 h-full ${c===e.children.length-1?"bg-transparent":"bg-primary-200"}`})]}),(0,t.jsx)("div",{className:"w-0.5 h-6 bg-primary-200"}),(0,t.jsx)("div",{className:"px-2 sm:px-3",children:(0,t.jsx)($,{node:r,level:s+1,expanded:a,toggleExpand:l,selectedId:n,onSelect:i,onQuickAdd:o})})]},r.id))})]})]})}function F({params:e}){let[s,a]=(0,r.useState)(""),[l,i]=(0,r.useState)(""),[o,c]=(0,r.useState)([]),[d,m]=(0,r.useState)(!0),[x,f]=(0,r.useState)(new Set),[p,E]=(0,r.useState)(null),[S,C]=(0,r.useState)(1),[L,F]=(0,r.useState)(window.innerWidth<768?"list":"tree"),P=(0,r.useRef)(null),T=(0,r.useRef)(null),[W,z]=(0,r.useState)(null);(0,r.useEffect)(()=>{e.then(e=>{a(e.id),D(e.id)})},[e]);let D=async e=>{try{let s=await fetch(`/api/members?baniId=${e}`),a=await s.json();c(a);let t=new Set;a.forEach(e=>{e.generation<=1&&t.add(e.id)}),f(t)}catch(e){console.error("Failed to fetch:",e)}finally{m(!1)}},H=function(e,s){let a;if(0===e.length)return null;let t=new Map;return e.forEach(e=>t.set(e.id,e)),a||(a=e.find(e=>0===e.generation)),a||(a=e.reduce((e,s)=>e.generation<s.generation?e:s)),function s(a){let t=e.filter(e=>e.fatherId===a.id||e.motherId===a.id).filter((e,s,a)=>a.findIndex(s=>s.id===e.id)===s).sort((e,s)=>e.fullName.localeCompare(s.fullName));return{...a,children:t.map(e=>s(e))}}(a)}(o),_=(0,r.useCallback)(e=>{f(s=>{let a=new Set(s);return a.has(e)?a.delete(e):a.add(e),a})},[]),G=p?o.find(e=>e.id===p):null,O=(0,r.useCallback)((e,s)=>{z({type:s,member:e})},[]),J=(0,r.useCallback)(()=>{z(null),s&&D(s)},[s]);return d?(0,t.jsx)("div",{className:"flex items-center justify-center min-h-[60vh]",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"w-12 h-12 border-4 border-primary-200 border-t-primary-600 rounded-full animate-spin mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-surface-500",children:"Memuat pohon nasab..."})]})}):(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)(n(),{href:`/dashboard/bani/${s}`,className:"touch-target p-2 rounded-xl hover:bg-surface-100 transition-colors",children:(0,t.jsx)(b.A,{className:"w-5 h-5 text-surface-600"})}),(0,t.jsx)("h1",{className:"text-xl sm:text-2xl font-bold text-surface-900",children:"Pohon Nasab"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)("div",{className:"flex rounded-lg border border-surface-200 overflow-hidden",children:[(0,t.jsx)("button",{onClick:()=>F("tree"),className:`p-2 transition-colors ${"tree"===L?"bg-primary-50 text-primary-600":"text-surface-400 hover:bg-surface-50"}`,title:"Tampilan Pohon",children:(0,t.jsx)(g.A,{className:"w-4 h-4"})}),(0,t.jsx)("button",{onClick:()=>F("list"),className:`p-2 transition-colors ${"list"===L?"bg-primary-50 text-primary-600":"text-surface-400 hover:bg-surface-50"}`,title:"Tampilan Daftar",children:(0,t.jsx)(j.A,{className:"w-4 h-4"})})]}),"tree"===L&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("button",{onClick:()=>C(e=>Math.max(e-.1,.3)),className:"touch-target p-2 rounded-lg border border-surface-200 hover:bg-surface-100 transition-colors hidden sm:block",children:(0,t.jsx)(N.A,{className:"w-4 h-4 text-surface-600"})}),(0,t.jsxs)("span",{className:"text-sm text-surface-500 min-w-[3rem] text-center hidden sm:block",children:[Math.round(100*S),"%"]}),(0,t.jsx)("button",{onClick:()=>C(e=>Math.min(e+.1,2)),className:"touch-target p-2 rounded-lg border border-surface-200 hover:bg-surface-100 transition-colors hidden sm:block",children:(0,t.jsx)(y.A,{className:"w-4 h-4 text-surface-600"})}),(0,t.jsx)("button",{onClick:()=>C(1),className:"touch-target p-2 rounded-lg border border-surface-200 hover:bg-surface-100 transition-colors hidden sm:block",children:(0,t.jsx)(v.A,{className:"w-4 h-4 text-surface-600"})})]})]})]}),"list"===L?(0,t.jsx)(M,{members:o,baniId:s}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[(0,t.jsx)("button",{onClick:()=>{f(new Set(o.map(e=>e.id)))},className:"touch-target px-4 py-2 rounded-lg text-sm font-medium border border-surface-200 hover:bg-surface-100 text-surface-600 transition-colors",children:"Buka Semua"}),(0,t.jsx)("button",{onClick:()=>{f(new Set)},className:"touch-target px-4 py-2 rounded-lg text-sm font-medium border border-surface-200 hover:bg-surface-100 text-surface-600 transition-colors",children:"Tutup Semua"}),(0,t.jsx)("div",{className:"ml-auto",children:(0,t.jsx)(A.A,{treeContainerRef:T,baniName:l||"Pohon-Nasab"})})]}),(0,t.jsx)("div",{ref:P,className:"overflow-auto rounded-2xl bg-white border border-surface-200 min-h-[60vh] p-8",children:(0,t.jsx)("div",{ref:T,children:(0,t.jsx)("div",{style:{transform:`scale(${S})`,transformOrigin:"top center"},className:"inline-flex justify-center w-full transition-transform duration-200",children:H?(0,t.jsx)($,{node:H,level:0,expanded:x,toggleExpand:_,selectedId:p,onSelect:E,onQuickAdd:O}):(0,t.jsx)("div",{className:"text-center py-20",children:(0,t.jsx)("p",{className:"text-surface-500",children:"Belum ada anggota di pohon ini"})})})})}),G&&(0,t.jsx)("div",{className:"rounded-2xl bg-white border border-surface-200 p-6 animate-slide-up",children:(0,t.jsxs)("div",{className:"flex items-start gap-4",children:[(0,t.jsx)("div",{className:`w-16 h-16 rounded-full flex items-center justify-center ${"MALE"===G.gender?"bg-blue-100 text-blue-600":"bg-pink-100 text-pink-600"}`,children:(0,t.jsx)(u.A,{className:"w-8 h-8"})}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("h3",{className:"text-lg font-semibold text-surface-900",children:[G.fullName,!G.isAlive&&(0,t.jsx)("span",{className:"ml-2 text-sm font-normal text-surface-400",children:"(Almarhum/ah)"})]}),G.nickname&&(0,t.jsx)("p",{className:"text-sm text-surface-500",children:G.nickname}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-3 mt-3",children:[(0,t.jsxs)("span",{className:"text-xs px-2 py-1 rounded-lg bg-surface-100 text-surface-600",children:["Generasi ",G.generation+1]}),(0,t.jsx)("span",{className:`text-xs px-2 py-1 rounded-lg ${"MALE"===G.gender?"bg-blue-50 text-blue-700":"bg-pink-50 text-pink-700"}`,children:"MALE"===G.gender?"Laki-laki":"Perempuan"}),G.city&&(0,t.jsxs)("span",{className:"text-xs px-2 py-1 rounded-lg bg-surface-100 text-surface-600",children:["\uD83D\uDCCD ",G.city]})]}),G.phoneWhatsapp&&(0,t.jsxs)("a",{href:(0,k.rr)(G.phoneWhatsapp),target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 mt-3 px-4 py-2 rounded-lg bg-green-500 text-white text-sm font-medium hover:bg-green-400 transition-colors",children:[(0,t.jsx)(h.A,{className:"w-4 h-4"}),"Chat WhatsApp"]}),(0,t.jsxs)(n(),{href:`/dashboard/bani/${s}/members/${G.id}`,className:"inline-flex items-center gap-2 mt-3 ml-2 px-4 py-2 rounded-lg border border-primary-200 text-primary-600 text-sm font-medium hover:bg-primary-50 transition-colors",children:[(0,t.jsx)(w.A,{className:"w-4 h-4"}),"Lihat Detail"]})]})]})})]}),W&&(0,t.jsx)(I,{context:W,allMembers:o,baniId:s,onClose:()=>z(null),onSuccess:J})]})}},34868:(e,s,a)=>{"use strict";a.d(s,{A:()=>d});var t=a(95155),r=a(12115),l=a(6296),n=a(6962),i=a(17243),o=a(48368),c=a(33210);function d({treeContainerRef:e,baniName:s}){let[d,m]=(0,r.useState)(!1),[x,u]=(0,r.useState)(!1),[h,f]=(0,r.useState)(""),p=async()=>{let s=e.current;if(!s)throw Error("Tree element not found");let t=s.parentElement,r=s.querySelector("[style*='transform']"),l=r?.style.transform||"",n=t?.style.overflow||"",i=t?.style.maxHeight||"",o=t?.style.height||"";try{r&&(r.style.transform="scale(1)"),t&&(t.style.overflow="visible",t.style.maxHeight="none",t.style.height="auto"),await new Promise(e=>setTimeout(e,100));let{toPng:e}=await a.e(8634).then(a.bind(a,28634));return await e(s,{backgroundColor:"#ffffff",pixelRatio:2,cacheBust:!0})}finally{r&&(r.style.transform=l),t&&(t.style.overflow=n,t.style.maxHeight=i,t.style.height=o)}},b=async()=>{m(!0),f("");try{let e=await p(),a=document.createElement("a");a.download=`${s.replace(/\s+/g,"-")}-tree.png`,a.href=e,a.click()}catch(e){console.error("Export image error:",e),f("Gagal mengekspor gambar")}finally{m(!1),u(!1)}},g=async()=>{m(!0),f("");try{let e=await p(),{jsPDF:t}=await Promise.all([a.e(5033),a.e(3930),a.e(4233)]).then(a.bind(a,18831)),r=new Image;await new Promise((s,a)=>{r.onload=()=>s(),r.onerror=()=>a(Error("Failed to load image")),r.src=e});let l=r.naturalWidth,n=r.naturalHeight,i=new t({orientation:l>n?"landscape":"portrait",unit:"mm"}),o=i.internal.pageSize.getWidth(),c=i.internal.pageSize.getHeight();i.setFontSize(16),i.setFont("helvetica","bold"),i.text(s,o/2,15,{align:"center"}),i.setFontSize(10),i.setFont("helvetica","normal"),i.text("Silsilah Keluarga — Jejak Nasab",o/2,22,{align:"center"});let d=o-20,m=c-30-10,x=d,u=n/l*d;u>m&&(u=m,x=l/n*m);let h=(o-x)/2;i.addImage(e,"PNG",h,30,x,u),i.setFontSize(8),i.setTextColor(150);let f=new Date().toLocaleDateString("id-ID",{day:"numeric",month:"long",year:"numeric"});i.text(`Dicetak dari Jejak Nasab — ${f}`,o/2,c-5,{align:"center"}),i.save(`${s.replace(/\s+/g,"-")}-tree.pdf`)}catch(e){console.error("Export PDF error:",e),f("Gagal mengekspor PDF")}finally{m(!1),u(!1)}};return(0,t.jsxs)("div",{className:"relative sm:inline-block",children:[(0,t.jsxs)("button",{onClick:()=>{u(!x),f("")},disabled:d,className:"w-full sm:w-auto inline-flex items-center justify-center gap-2 px-3 py-2 rounded-xl bg-primary-600 text-white font-medium text-xs hover:bg-primary-500 transition-colors shadow-md shadow-primary-600/20 disabled:opacity-50",children:[d?(0,t.jsx)(l.A,{className:"w-3.5 h-3.5 animate-spin"}):(0,t.jsx)(n.A,{className:"w-3.5 h-3.5"}),"Ekspor"]}),x&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"fixed inset-0 z-40",onClick:()=>u(!1)}),(0,t.jsxs)("div",{className:"absolute right-0 top-full mt-2 w-52 rounded-xl bg-white border border-surface-200 shadow-xl z-50 overflow-hidden",children:[(0,t.jsxs)("button",{onClick:b,disabled:d,className:"w-full flex items-center gap-3 px-4 py-3 text-sm text-surface-700 hover:bg-surface-50 transition-colors disabled:opacity-50",children:[(0,t.jsx)(i.A,{className:"w-4 h-4 text-blue-500"}),"Simpan sebagai PNG"]}),(0,t.jsxs)("button",{onClick:g,disabled:d,className:"w-full flex items-center gap-3 px-4 py-3 text-sm text-surface-700 hover:bg-surface-50 transition-colors border-t border-surface-100 disabled:opacity-50",children:[(0,t.jsx)(o.A,{className:"w-4 h-4 text-red-500"}),"Simpan sebagai PDF"]})]})]}),h&&(0,t.jsxs)("div",{className:"absolute right-0 top-full mt-2 p-3 rounded-xl bg-red-50 border border-red-200 text-red-600 text-xs flex items-start gap-2 z-50 max-w-[200px]",children:[(0,t.jsx)(c.A,{className:"w-3 h-3 flex-shrink-0 mt-0.5 cursor-pointer",onClick:()=>f("")}),h]})]})}},37280:(e,s,a)=>{Promise.resolve().then(a.bind(a,31734))},40980:(e,s,a)=>{"use strict";function t(e){let s=e.replace(/\D/g,"");return s.startsWith("0")&&(s="62"+s.substring(1)),`https://wa.me/${s}`}a.d(s,{rr:()=>t})}},e=>{e.O(0,[8500,7207,8441,3794,7358],()=>e(e.s=37280)),_N_E=e.O()}]);