(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,71689,e=>{"use strict";let t=(0,e.i(75254).default)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);e.s(["ArrowLeft",()=>t],71689)},43432,e=>{"use strict";let t=(0,e.i(75254).default)("phone",[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]]);e.s(["Phone",()=>t],43432)},31278,e=>{"use strict";let t=(0,e.i(75254).default)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);e.s(["Loader2",()=>t],31278)},84614,e=>{"use strict";let t=(0,e.i(75254).default)("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);e.s(["User",()=>t],84614)},90597,e=>{"use strict";let t=(0,e.i(75254).default)("heart",[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}]]);e.s(["Heart",()=>t],90597)},33651,e=>{"use strict";let t=(0,e.i(75254).default)("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]);e.s(["Download",()=>t],33651)},73708,e=>{"use strict";let t=(0,e.i(75254).default)("image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);e.s(["Image",()=>t],73708)},78583,e=>{"use strict";let t=(0,e.i(75254).default)("file-text",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);e.s(["FileText",()=>t],78583)},54212,20354,98361,64659,55900,78917,e=>{"use strict";var t=e.i(75254);let a=(0,t.default)("zoom-in",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]);e.s(["ZoomIn",()=>a],54212);let s=(0,t.default)("zoom-out",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]);e.s(["ZoomOut",()=>s],20354);let r=(0,t.default)("maximize-2",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]]);e.s(["Maximize2",()=>r],98361);let l=(0,t.default)("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);e.s(["ChevronDown",()=>l],64659);let i=(0,t.default)("chevron-up",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);e.s(["ChevronUp",()=>i],55900);let n=(0,t.default)("external-link",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);e.s(["ExternalLink",()=>n],78917)},70956,e=>{"use strict";let t=(0,e.i(75254).default)("list",[["path",{d:"M3 5h.01",key:"18ugdj"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 19h.01",key:"noohij"}],["path",{d:"M8 5h13",key:"1pao27"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 19h13",key:"m83p4d"}]]);e.s(["List",()=>t],70956)},19170,e=>{"use strict";let t=(0,e.i(75254).default)("baby",[["path",{d:"M10 16c.5.3 1.2.5 2 .5s1.5-.2 2-.5",key:"1u7htd"}],["path",{d:"M15 12h.01",key:"1k8ypt"}],["path",{d:"M19.38 6.813A9 9 0 0 1 20.8 10.2a2 2 0 0 1 0 3.6 9 9 0 0 1-17.6 0 2 2 0 0 1 0-3.6A9 9 0 0 1 12 3c2 0 3.5 1.1 3.5 2.5s-.9 2.5-2 2.5c-.8 0-1.5-.4-1.5-1",key:"11xh7x"}],["path",{d:"M9 12h.01",key:"157uk2"}]]);e.s(["Baby",()=>t],19170)},75157,17989,e=>{"use strict";function t(e){let t=e.replace(/\D/g,"");return t.startsWith("0")&&(t="62"+t.substring(1)),`https://wa.me/${t}`}e.s(["getWhatsAppLink",()=>t],75157);var a=e.i(43476),s=e.i(71645),r=e.i(33651),l=e.i(73708),i=e.i(78583),n=e.i(31278),d=e.i(37727);function o({treeContainerRef:t,baniName:o}){let[c,m]=(0,s.useState)(!1),[x,h]=(0,s.useState)(!1),[u,f]=(0,s.useState)(""),p=async()=>{let a=t.current;if(!a)throw Error("Tree element not found");let s=a.parentElement,r=a.querySelector("[style*='transform']"),l=r?.style.transform||"",i=s?.style.overflow||"",n=s?.style.maxHeight||"",d=s?.style.height||"";try{r&&(r.style.transform="scale(1)"),s&&(s.style.overflow="visible",s.style.maxHeight="none",s.style.height="auto"),await new Promise(e=>setTimeout(e,100));let{toPng:t}=await e.A(17571);return await t(a,{backgroundColor:"#ffffff",pixelRatio:2,cacheBust:!0})}finally{r&&(r.style.transform=l),s&&(s.style.overflow=i,s.style.maxHeight=n,s.style.height=d)}},b=async()=>{m(!0),f("");try{let e=await p(),t=document.createElement("a");t.download=`${o.replace(/\s+/g,"-")}-tree.png`,t.href=e,t.click()}catch(e){console.error("Export image error:",e),f("Gagal mengekspor gambar")}finally{m(!1),h(!1)}},g=async()=>{m(!0),f("");try{let t=await p(),{jsPDF:a}=await e.A(34162),s=new Image;await new Promise((e,a)=>{s.onload=()=>e(),s.onerror=()=>a(Error("Failed to load image")),s.src=t});let r=s.naturalWidth,l=s.naturalHeight,i=new a({orientation:r>l?"landscape":"portrait",unit:"mm"}),n=i.internal.pageSize.getWidth(),d=i.internal.pageSize.getHeight();i.setFontSize(16),i.setFont("helvetica","bold"),i.text(o,n/2,15,{align:"center"}),i.setFontSize(10),i.setFont("helvetica","normal"),i.text("Silsilah Keluarga â€” Jejak Nasab",n/2,22,{align:"center"});let c=n-20,m=d-30-10,x=c,h=l/r*c;h>m&&(h=m,x=r/l*m);let u=(n-x)/2;i.addImage(t,"PNG",u,30,x,h),i.setFontSize(8),i.setTextColor(150);let f=new Date().toLocaleDateString("id-ID",{day:"numeric",month:"long",year:"numeric"});i.text(`Dicetak dari Jejak Nasab â€” ${f}`,n/2,d-5,{align:"center"}),i.save(`${o.replace(/\s+/g,"-")}-tree.pdf`)}catch(e){console.error("Export PDF error:",e),f("Gagal mengekspor PDF")}finally{m(!1),h(!1)}};return(0,a.jsxs)("div",{className:"relative sm:inline-block",children:[(0,a.jsxs)("button",{onClick:()=>{h(!x),f("")},disabled:c,className:"w-full sm:w-auto inline-flex items-center justify-center gap-2 px-3 py-2 rounded-xl bg-primary-600 text-white font-medium text-xs hover:bg-primary-500 transition-colors shadow-md shadow-primary-600/20 disabled:opacity-50",children:[c?(0,a.jsx)(n.Loader2,{className:"w-3.5 h-3.5 animate-spin"}):(0,a.jsx)(r.Download,{className:"w-3.5 h-3.5"}),"Ekspor"]}),x&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"fixed inset-0 z-40",onClick:()=>h(!1)}),(0,a.jsxs)("div",{className:"absolute right-0 top-full mt-2 w-52 rounded-xl bg-white border border-surface-200 shadow-xl z-50 overflow-hidden",children:[(0,a.jsxs)("button",{onClick:b,disabled:c,className:"w-full flex items-center gap-3 px-4 py-3 text-sm text-surface-700 hover:bg-surface-50 transition-colors disabled:opacity-50",children:[(0,a.jsx)(l.Image,{className:"w-4 h-4 text-blue-500"}),"Simpan sebagai PNG"]}),(0,a.jsxs)("button",{onClick:g,disabled:c,className:"w-full flex items-center gap-3 px-4 py-3 text-sm text-surface-700 hover:bg-surface-50 transition-colors border-t border-surface-100 disabled:opacity-50",children:[(0,a.jsx)(i.FileText,{className:"w-4 h-4 text-red-500"}),"Simpan sebagai PDF"]})]})]}),u&&(0,a.jsxs)("div",{className:"absolute right-0 top-full mt-2 p-3 rounded-xl bg-red-50 border border-red-200 text-red-600 text-xs flex items-start gap-2 z-50 max-w-[200px]",children:[(0,a.jsx)(d.X,{className:"w-3 h-3 flex-shrink-0 mt-0.5 cursor-pointer",onClick:()=>f("")}),u]})]})}e.s(["default",()=>o],17989)},63059,73375,e=>{"use strict";var t=e.i(75254);let a=(0,t.default)("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);e.s(["ChevronRight",()=>a],63059);let s=(0,t.default)("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);e.s(["ChevronLeft",()=>s],73375)},29278,e=>{"use strict";var t=e.i(43476),a=e.i(71645),s=e.i(22016),r=e.i(71689),l=e.i(54212),i=e.i(20354),n=e.i(98361),d=e.i(43432),o=e.i(84614),c=e.i(64659),m=e.i(55900),x=e.i(78917),h=e.i(75254);let u=(0,h.default)("network",[["rect",{x:"16",y:"16",width:"6",height:"6",rx:"1",key:"4q2zg0"}],["rect",{x:"2",y:"16",width:"6",height:"6",rx:"1",key:"8cvhb9"}],["rect",{x:"9",y:"2",width:"6",height:"6",rx:"1",key:"1egb70"}],["path",{d:"M5 16v-3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3",key:"1jsf9p"}],["path",{d:"M12 12V8",key:"2874zd"}]]);var f=e.i(70956),p=e.i(7233),b=e.i(19170),g=e.i(90597),y=e.i(61911),j=e.i(31278),N=e.i(37727),v=e.i(75157),k=e.i(17989),w=e.i(63059),A=e.i(73375);let M=(0,h.default)("layers",[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]]);function C({members:e,baniId:r}){let[l,i]=(0,a.useState)(0),[n,c]=(0,a.useState)(null),m=(0,a.useMemo)(()=>Math.max(...e.map(e=>e.generation),0),[e]),x=Array.from({length:m+1},(e,t)=>t),h=(0,a.useMemo)(()=>{let t=e.filter(e=>e.generation===l);return n&&l>0&&(t=t.filter(e=>e.fatherId===n||e.motherId===n)),t.sort((e,t)=>e.fullName.localeCompare(t.fullName))},[e,l,n]),u=n?e.find(e=>e.id===n)?.fullName:null;return(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("div",{className:"flex items-center gap-2 overflow-x-auto pb-2 scrollbar-hide",children:x.map(e=>(0,t.jsxs)("button",{onClick:()=>{i(e),c(null)},className:`flex-shrink-0 px-4 py-2.5 rounded-xl text-sm font-medium transition-all ${l===e?"bg-primary-600 text-white shadow-md shadow-primary-600/20":"bg-white border border-surface-200 text-surface-600 hover:bg-surface-50"}`,children:["Gen ",e+1]},e))}),(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,t.jsx)(M,{className:"w-4 h-4 text-surface-400"}),(0,t.jsxs)("span",{className:"text-surface-500",children:["Generasi ",l+1]}),u&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(w.ChevronRight,{className:"w-3 h-3 text-surface-300"}),(0,t.jsx)("span",{className:"text-primary-600 font-medium",children:u})]}),(n||l>0)&&(0,t.jsxs)("button",{onClick:()=>{if(n&&l>0){let t=e.find(e=>e.id===n);t&&(i(l-1),c(t.fatherId||t.motherId||null))}else i(Math.max(0,l-1)),c(null)},className:"ml-auto flex items-center gap-1 px-3 py-1.5 rounded-lg text-xs text-surface-600 bg-surface-100 hover:bg-surface-200 transition-colors",children:[(0,t.jsx)(A.ChevronLeft,{className:"w-3 h-3"}),"Kembali"]})]}),(0,t.jsx)("div",{className:"space-y-3",children:0===h.length?(0,t.jsxs)("div",{className:"text-center py-12 rounded-2xl bg-white border border-surface-200",children:[(0,t.jsx)(o.User,{className:"w-10 h-10 text-surface-300 mx-auto mb-3"}),(0,t.jsx)("p",{className:"text-surface-500 text-sm",children:"Tidak ada anggota di generasi ini"})]}):h.map(a=>{let n=e.filter(e=>e.generation===l+1&&(e.fatherId===a.id||e.motherId===a.id)).length;return(0,t.jsxs)("div",{className:"rounded-2xl bg-white border border-surface-200 overflow-hidden hover:shadow-md transition-all",children:[(0,t.jsxs)("div",{className:"p-4 flex items-center gap-3",children:[(0,t.jsx)("div",{className:`w-14 h-14 rounded-xl flex items-center justify-center flex-shrink-0 ${"MALE"===a.gender?"bg-blue-50 text-blue-600":"bg-pink-50 text-pink-600"} ${!a.isAlive?"opacity-60":""}`,children:a.photo?(0,t.jsx)("img",{src:a.photo,alt:a.fullName,className:"w-14 h-14 rounded-xl object-cover"}):(0,t.jsx)(o.User,{className:"w-7 h-7"})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("p",{className:"font-semibold text-surface-900 truncate",children:a.fullName}),!a.isAlive&&(0,t.jsx)("span",{className:"text-xs px-1.5 py-0.5 rounded bg-surface-100 text-surface-500 flex-shrink-0",children:"Alm."})]}),a.nickname&&(0,t.jsx)("p",{className:"text-xs text-surface-400",children:a.nickname}),(0,t.jsxs)("div",{className:"flex items-center gap-3 mt-1",children:[a.city&&(0,t.jsxs)("span",{className:"text-xs text-surface-400",children:["ðŸ“ ",a.city]}),n>0&&(0,t.jsxs)("span",{className:"text-xs text-primary-600 font-medium",children:[n," anak"]})]})]}),(0,t.jsx)("div",{className:"flex items-center gap-1 flex-shrink-0",children:a.phoneWhatsapp&&(0,t.jsx)("a",{href:(0,v.getWhatsAppLink)(a.phoneWhatsapp),target:"_blank",rel:"noopener noreferrer",className:"touch-target p-2 rounded-lg hover:bg-green-50 transition-colors",children:(0,t.jsx)(d.Phone,{className:"w-5 h-5 text-green-600"})})})]}),(0,t.jsxs)("div",{className:"flex border-t border-surface-100",children:[(0,t.jsx)(s.default,{href:`/dashboard/bani/${r}/members/${a.id}`,className:"flex-1 py-3 text-center text-xs font-medium text-primary-600 hover:bg-primary-50 transition-colors",children:"Detail"}),n>0&&(0,t.jsxs)("button",{onClick:()=>{var t;return t=a.id,void(l<m&&e.filter(e=>e.generation===l+1&&(e.fatherId===t||e.motherId===t)).length>0&&(c(t),i(l+1)))},className:"flex-1 py-3 text-center text-xs font-medium text-gold-600 hover:bg-gold-50 transition-colors border-l border-surface-100 flex items-center justify-center gap-1",children:["Lihat Anak",(0,t.jsx)(w.ChevronRight,{className:"w-3 h-3"})]})]})]},a.id)})}),(0,t.jsxs)("div",{className:"text-center text-xs text-surface-400 pt-2",children:[h.length," anggota di generasi ",l+1,u?` (keturunan ${u})`:""]})]})}function E({node:e,onSelect:a,onClose:s}){return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"fixed inset-0 z-40",onClick:s}),(0,t.jsxs)("div",{className:"absolute top-full left-0 mt-1 z-50 bg-white rounded-xl shadow-xl border border-surface-200 py-1.5 min-w-[180px] animate-fade-in",children:[(0,t.jsxs)("button",{onClick:()=>a("child"),className:"w-full flex items-center gap-3 px-4 py-2.5 text-sm text-surface-700 hover:bg-primary-50 hover:text-primary-700 transition-colors text-left",children:[(0,t.jsx)(b.Baby,{className:"w-4 h-4"}),"Tambah Anak"]}),(0,t.jsxs)("button",{onClick:()=>a("spouse"),className:"w-full flex items-center gap-3 px-4 py-2.5 text-sm text-surface-700 hover:bg-pink-50 hover:text-pink-700 transition-colors text-left",children:[(0,t.jsx)(g.Heart,{className:"w-4 h-4"}),"Tambah Pasangan"]}),(0,t.jsxs)("button",{onClick:()=>a("sibling"),className:"w-full flex items-center gap-3 px-4 py-2.5 text-sm text-surface-700 hover:bg-blue-50 hover:text-blue-700 transition-colors text-left",children:[(0,t.jsx)(y.Users,{className:"w-4 h-4"}),"Tambah Saudara"]})]})]})}function S({context:e,allMembers:s,baniId:r,onClose:l,onSuccess:i}){let[n,d]=(0,a.useState)(""),[o,c]=(0,a.useState)(""),[m,x]=(0,a.useState)("MALE"),[h,u]=(0,a.useState)(!0),[f,b]=(0,a.useState)(!1),[g,y]=(0,a.useState)(""),[v,k]=(0,a.useState)(""),{type:w,member:A}=e,M=[];"MALE"===A.gender&&A.marriagesAsHusband?A.marriagesAsHusband.forEach(e=>M.push(e.wife)):"FEMALE"===A.gender&&A.marriagesAsWife&&A.marriagesAsWife.forEach(e=>M.push(e.husband));let C=1===M.length,E=M.length>1;(0,a.useEffect)(()=>{"child"===w&&C&&k(M[0].id)},[w,C]);let S="child"===w?`Tambah Anak ${A.fullName}`:"spouse"===w?`Tambah Pasangan ${A.fullName}`:`Tambah Saudara ${A.fullName}`,L="child"===w?"Anggota baru akan menjadi anak dari orang ini":"spouse"===w?"Anggota baru akan menjadi pasangan orang ini":"Anggota baru akan memiliki orang tua yang sama";(0,a.useEffect)(()=>{"spouse"===w&&x("MALE"===A.gender?"FEMALE":"MALE")},[w,A.gender]);let I="child"===w?M.length>0?M.map(e=>({id:e.id,fullName:e.fullName,gender:e.gender,generation:0})):"MALE"===A.gender?s.filter(e=>"FEMALE"===e.gender):s.filter(e=>"MALE"===e.gender):[],P=async e=>{if(e.preventDefault(),n.trim()){b(!0),y("");try{let e,t;"child"===w?"MALE"===A.gender?(e=A.id,t=v||void 0):(t=A.id,e=v||void 0):"sibling"===w&&(e=A.fatherId||void 0,t=A.motherId||void 0);let a=await fetch("/api/members",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({baniId:r,fullName:n.trim(),nickname:o.trim()||void 0,gender:m,isAlive:h,fatherId:e,motherId:t})}),s=await a.json();if(!a.ok)return void y(s.error||"Gagal menyimpan");if("spouse"===w){let e="MALE"===A.gender?A.id:s.id,t="FEMALE"===A.gender?A.id:s.id;(await fetch("/api/marriages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({husbandId:e,wifeId:t})})).ok||console.error("Failed to create marriage, but member was created")}i()}catch{y("Terjadi kesalahan. Silakan coba lagi.")}finally{b(!1)}}};return(0,t.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-black/40 backdrop-blur-sm",onClick:l}),(0,t.jsxs)("div",{className:"relative bg-white rounded-2xl shadow-2xl w-full max-w-md max-h-[90vh] overflow-y-auto animate-scale-in",children:[(0,t.jsxs)("div",{className:"sticky top-0 bg-white rounded-t-2xl border-b border-surface-100 p-5 flex items-start justify-between z-10",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-lg font-bold text-surface-900",children:S}),(0,t.jsx)("p",{className:"text-xs text-surface-400 mt-0.5",children:L})]}),(0,t.jsx)("button",{onClick:l,className:"p-1.5 rounded-lg hover:bg-surface-100 transition-colors text-surface-400",children:(0,t.jsx)(N.X,{className:"w-5 h-5"})})]}),(0,t.jsxs)("form",{onSubmit:P,className:"p-5 space-y-4",children:[g&&(0,t.jsx)("div",{className:"p-3 rounded-xl bg-red-50 border border-red-200 text-red-700 text-sm",children:g}),"child"===w&&(0,t.jsx)("div",{className:"p-3 rounded-xl bg-primary-50 border border-primary-100",children:(0,t.jsxs)("p",{className:"text-xs font-medium text-primary-700",children:["MALE"===A.gender?"ðŸ‘¨ Ayah":"ðŸ‘© Ibu",":"," ",(0,t.jsx)("span",{className:"font-bold",children:A.fullName})]})}),"sibling"===w&&(A.fatherId||A.motherId)&&(0,t.jsxs)("div",{className:"p-3 rounded-xl bg-blue-50 border border-blue-100 space-y-1",children:[(0,t.jsxs)("p",{className:"text-xs text-blue-600",children:["Orang tua yang sama dengan ",A.fullName,":"]}),A.fatherId&&(0,t.jsxs)("p",{className:"text-xs font-medium text-blue-700",children:["ðŸ‘¨ Ayah: ",s.find(e=>e.id===A.fatherId)?.fullName||"â€”"]}),A.motherId&&(0,t.jsxs)("p",{className:"text-xs font-medium text-blue-700",children:["ðŸ‘© Ibu: ",s.find(e=>e.id===A.motherId)?.fullName||"â€”"]})]}),"spouse"===w&&(0,t.jsx)("div",{className:"p-3 rounded-xl bg-pink-50 border border-pink-100",children:(0,t.jsxs)("p",{className:"text-xs font-medium text-pink-700",children:["ðŸ’‘ Pasangan dari: ",(0,t.jsx)("span",{className:"font-bold",children:A.fullName})]})}),"child"===w&&C&&(0,t.jsx)("div",{className:"p-3 rounded-xl bg-primary-50 border border-primary-100",children:(0,t.jsxs)("p",{className:"text-xs font-medium text-primary-700",children:["MALE"===A.gender?"ðŸ‘© Ibu":"ðŸ‘¨ Ayah",":"," ",(0,t.jsx)("span",{className:"font-bold",children:M[0].fullName})]})}),"child"===w&&E&&(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-surface-700 mb-1.5",children:"MALE"===A.gender?"Ibu":"Ayah"}),(0,t.jsxs)("select",{value:v,onChange:e=>k(e.target.value),className:"w-full px-3 py-2.5 rounded-xl border border-surface-200 text-sm text-surface-900 focus:outline-none focus:border-primary-500 bg-white",children:[(0,t.jsxs)("option",{value:"",children:["â€” Pilih ","MALE"===A.gender?"Ibu":"Ayah"," â€”"]}),I.map(e=>(0,t.jsx)("option",{value:e.id,children:e.fullName},e.id))]})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("label",{className:"block text-sm font-medium text-surface-700 mb-1.5",children:["Nama Lengkap ",(0,t.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,t.jsx)("input",{type:"text",value:n,onChange:e=>d(e.target.value),className:"w-full px-3 py-2.5 rounded-xl border border-surface-200 text-sm text-surface-900 placeholder-surface-400 focus:outline-none focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 transition-all",placeholder:"Nama lengkap",required:!0,autoFocus:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-surface-700 mb-1.5",children:"Nama Panggilan"}),(0,t.jsx)("input",{type:"text",value:o,onChange:e=>c(e.target.value),className:"w-full px-3 py-2.5 rounded-xl border border-surface-200 text-sm text-surface-900 placeholder-surface-400 focus:outline-none focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 transition-all",placeholder:"Panggilan sehari-hari"})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("label",{className:"block text-sm font-medium text-surface-700 mb-1.5",children:["Jenis Kelamin ",(0,t.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{type:"button",onClick:()=>x("MALE"),className:`flex-1 py-2.5 rounded-xl border text-sm font-medium transition-all ${"MALE"===m?"border-blue-500 bg-blue-50 text-blue-700":"border-surface-200 text-surface-500 hover:bg-surface-50"}`,children:"ðŸ‘¨ Laki-laki"}),(0,t.jsx)("button",{type:"button",onClick:()=>x("FEMALE"),className:`flex-1 py-2.5 rounded-xl border text-sm font-medium transition-all ${"FEMALE"===m?"border-pink-500 bg-pink-50 text-pink-700":"border-surface-200 text-surface-500 hover:bg-surface-50"}`,children:"ðŸ‘© Perempuan"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-surface-700 mb-1.5",children:"Status"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{type:"button",onClick:()=>u(!0),className:`flex-1 py-2.5 rounded-xl border text-sm font-medium transition-all ${h?"border-green-500 bg-green-50 text-green-700":"border-surface-200 text-surface-500 hover:bg-surface-50"}`,children:"â¤ï¸ Hidup"}),(0,t.jsx)("button",{type:"button",onClick:()=>u(!1),className:`flex-1 py-2.5 rounded-xl border text-sm font-medium transition-all ${!h?"border-surface-500 bg-surface-100 text-surface-700":"border-surface-200 text-surface-500 hover:bg-surface-50"}`,children:"ðŸ•Šï¸ Wafat"})]})]}),(0,t.jsxs)("div",{className:"flex gap-3 pt-2",children:[(0,t.jsx)("button",{type:"button",onClick:l,className:"flex-1 py-2.5 rounded-xl border border-surface-200 text-surface-600 font-medium text-sm hover:bg-surface-50 transition-colors",children:"Batal"}),(0,t.jsx)("button",{type:"submit",disabled:f||!n.trim(),className:"flex-1 py-2.5 rounded-xl bg-gradient-to-r from-primary-600 to-primary-700 text-white font-semibold text-sm hover:from-primary-500 hover:to-primary-600 transition-all shadow-lg shadow-primary-600/20 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:f?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(j.Loader2,{className:"w-4 h-4 animate-spin"}),"Menyimpan..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(p.Plus,{className:"w-4 h-4"}),"Simpan"]})})]})]})]})]})}function L({node:e,level:s,expanded:r,toggleExpand:l,selectedId:i,onSelect:n,onQuickAdd:x}){let h,[u,f]=(0,a.useState)(!1),b=r.has(e.id),g=e.children.length>0,y=i===e.id;return(0,t.jsxs)("div",{className:"flex flex-col items-center",children:[(0,t.jsxs)("div",{onClick:()=>n(e.id),className:`tree-node relative cursor-pointer rounded-2xl border-2 p-3 w-36 sm:w-44 text-center transition-all group ${y?"border-primary-500 bg-primary-50 shadow-lg shadow-primary-500/20":e.isAlive?"MALE"===e.gender?"border-blue-200 bg-white hover:border-blue-400":"border-pink-200 bg-white hover:border-pink-400":"border-surface-200 bg-surface-50 opacity-80 hover:opacity-100"}`,children:[(0,t.jsx)("div",{className:`w-12 h-12 rounded-full mx-auto mb-2 flex items-center justify-center ${"MALE"===e.gender?"bg-blue-100 text-blue-600":"bg-pink-100 text-pink-600"}`,children:e.photo?(0,t.jsx)("img",{src:e.photo,alt:e.fullName,className:"w-12 h-12 rounded-full object-cover"}):(0,t.jsx)(o.User,{className:"w-6 h-6"})}),(0,t.jsx)("p",{className:"text-xs sm:text-sm font-semibold text-surface-900 truncate",children:e.fullName}),e.nickname&&(0,t.jsxs)("p",{className:"text-[10px] text-surface-400 truncate",children:["(",e.nickname,")"]}),!e.isAlive&&(0,t.jsx)("span",{className:"inline-block text-[10px] px-1.5 py-0.5 rounded bg-surface-200 text-surface-500 mt-1",children:"Alm."}),(h=[],("MALE"===e.gender&&e.marriagesAsHusband?e.marriagesAsHusband.forEach(e=>h.push(e.wife.fullName)):"FEMALE"===e.gender&&e.marriagesAsWife&&e.marriagesAsWife.forEach(e=>h.push(e.husband.fullName)),0===h.length)?null:(0,t.jsx)("div",{className:"mt-1.5 space-y-0.5",children:h.map((a,s)=>(0,t.jsxs)("p",{className:`text-[9px] sm:text-[10px] truncate px-1.5 py-0.5 rounded-full ${"MALE"===e.gender?"bg-pink-50 text-pink-500":"bg-blue-50 text-blue-500"}`,children:["ðŸ’‘ ",a]},s))})),e.phoneWhatsapp&&e.isAlive&&(0,t.jsx)("a",{href:(0,v.getWhatsAppLink)(e.phoneWhatsapp),target:"_blank",rel:"noopener noreferrer",onClick:e=>e.stopPropagation(),className:"absolute -top-2 -right-2 w-7 h-7 rounded-full bg-green-500 text-white flex items-center justify-center shadow-md hover:bg-green-400 transition-colors",children:(0,t.jsx)(d.Phone,{className:"w-3.5 h-3.5"})}),(0,t.jsxs)("div",{className:"absolute -top-2 -left-2 z-30",children:[(0,t.jsx)("button",{onClick:e=>{e.stopPropagation(),f(!u)},className:"w-7 h-7 rounded-full bg-emerald-500 text-white flex items-center justify-center shadow-md hover:bg-emerald-400 transition-all opacity-0 group-hover:opacity-100 focus:opacity-100 hover:scale-110",title:"Tambah keluarga",children:(0,t.jsx)(p.Plus,{className:"w-3.5 h-3.5"})}),u&&(0,t.jsx)(E,{node:e,onSelect:t=>{f(!1),x(e,t)},onClose:()=>f(!1)})]}),g&&(0,t.jsx)("button",{onClick:t=>{t.stopPropagation(),l(e.id)},className:"absolute -bottom-3 left-1/2 -translate-x-1/2 w-6 h-6 rounded-full bg-primary-500 text-white flex items-center justify-center shadow-md hover:bg-primary-400 transition-colors text-xs",children:b?(0,t.jsx)(m.ChevronUp,{className:"w-3.5 h-3.5"}):(0,t.jsx)(c.ChevronDown,{className:"w-3.5 h-3.5"})})]}),g&&b&&(0,t.jsxs)("div",{className:"flex flex-col items-center",children:[(0,t.jsx)("div",{className:"w-0.5 h-8 bg-gradient-to-b from-primary-300 to-primary-200"}),(0,t.jsx)("div",{className:"flex",children:e.children.map((a,d)=>(0,t.jsxs)("div",{className:"flex flex-col items-center relative",children:[e.children.length>1&&(0,t.jsxs)("div",{className:"flex w-full h-0.5",children:[(0,t.jsx)("div",{className:`flex-1 h-full ${0===d?"bg-transparent":"bg-primary-200"}`}),(0,t.jsx)("div",{className:`flex-1 h-full ${d===e.children.length-1?"bg-transparent":"bg-primary-200"}`})]}),(0,t.jsx)("div",{className:"w-0.5 h-6 bg-primary-200"}),(0,t.jsx)("div",{className:"px-2 sm:px-3",children:(0,t.jsx)(L,{node:a,level:s+1,expanded:r,toggleExpand:l,selectedId:i,onSelect:n,onQuickAdd:x})})]},a.id))})]})]})}function I({params:e}){let[c,m]=(0,a.useState)(""),[h,p]=(0,a.useState)(""),[b,g]=(0,a.useState)([]),[y,j]=(0,a.useState)(!0),[N,w]=(0,a.useState)(new Set),[A,M]=(0,a.useState)(null),[E,I]=(0,a.useState)(1),[P,z]=(0,a.useState)(window.innerWidth<768?"list":"tree"),$=(0,a.useRef)(null),F=(0,a.useRef)(null),[T,H]=(0,a.useState)(null);(0,a.useEffect)(()=>{e.then(e=>{m(e.id),W(e.id)})},[e]);let W=async e=>{try{let t=await fetch(`/api/members?baniId=${e}`),a=await t.json();g(a);let s=new Set;a.forEach(e=>{e.generation<=1&&s.add(e.id)}),w(s)}catch(e){console.error("Failed to fetch:",e)}finally{j(!1)}},D=function(e,t){let a;if(0===e.length)return null;let s=new Map;return e.forEach(e=>s.set(e.id,e)),a||(a=e.find(e=>0===e.generation)),a||(a=e.reduce((e,t)=>e.generation<t.generation?e:t)),function t(a){let s=e.filter(e=>e.fatherId===a.id||e.motherId===a.id).filter((e,t,a)=>a.findIndex(t=>t.id===e.id)===t).sort((e,t)=>e.fullName.localeCompare(t.fullName));return{...a,children:s.map(e=>t(e))}}(a)}(b),q=(0,a.useCallback)(e=>{w(t=>{let a=new Set(t);return a.has(e)?a.delete(e):a.add(e),a})},[]),O=A?b.find(e=>e.id===A):null,U=(0,a.useCallback)((e,t)=>{H({type:t,member:e})},[]),R=(0,a.useCallback)(()=>{H(null),c&&W(c)},[c]);return y?(0,t.jsx)("div",{className:"flex items-center justify-center min-h-[60vh]",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"w-12 h-12 border-4 border-primary-200 border-t-primary-600 rounded-full animate-spin mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-surface-500",children:"Memuat pohon nasab..."})]})}):(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)(s.default,{href:`/dashboard/bani/${c}`,className:"touch-target p-2 rounded-xl hover:bg-surface-100 transition-colors",children:(0,t.jsx)(r.ArrowLeft,{className:"w-5 h-5 text-surface-600"})}),(0,t.jsx)("h1",{className:"text-xl sm:text-2xl font-bold text-surface-900",children:"Pohon Nasab"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)("div",{className:"flex rounded-lg border border-surface-200 overflow-hidden",children:[(0,t.jsx)("button",{onClick:()=>z("tree"),className:`p-2 transition-colors ${"tree"===P?"bg-primary-50 text-primary-600":"text-surface-400 hover:bg-surface-50"}`,title:"Tampilan Pohon",children:(0,t.jsx)(u,{className:"w-4 h-4"})}),(0,t.jsx)("button",{onClick:()=>z("list"),className:`p-2 transition-colors ${"list"===P?"bg-primary-50 text-primary-600":"text-surface-400 hover:bg-surface-50"}`,title:"Tampilan Daftar",children:(0,t.jsx)(f.List,{className:"w-4 h-4"})})]}),"tree"===P&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("button",{onClick:()=>I(e=>Math.max(e-.1,.3)),className:"touch-target p-2 rounded-lg border border-surface-200 hover:bg-surface-100 transition-colors hidden sm:block",children:(0,t.jsx)(i.ZoomOut,{className:"w-4 h-4 text-surface-600"})}),(0,t.jsxs)("span",{className:"text-sm text-surface-500 min-w-[3rem] text-center hidden sm:block",children:[Math.round(100*E),"%"]}),(0,t.jsx)("button",{onClick:()=>I(e=>Math.min(e+.1,2)),className:"touch-target p-2 rounded-lg border border-surface-200 hover:bg-surface-100 transition-colors hidden sm:block",children:(0,t.jsx)(l.ZoomIn,{className:"w-4 h-4 text-surface-600"})}),(0,t.jsx)("button",{onClick:()=>I(1),className:"touch-target p-2 rounded-lg border border-surface-200 hover:bg-surface-100 transition-colors hidden sm:block",children:(0,t.jsx)(n.Maximize2,{className:"w-4 h-4 text-surface-600"})})]})]})]}),"list"===P?(0,t.jsx)(C,{members:b,baniId:c}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[(0,t.jsx)("button",{onClick:()=>{w(new Set(b.map(e=>e.id)))},className:"touch-target px-4 py-2 rounded-lg text-sm font-medium border border-surface-200 hover:bg-surface-100 text-surface-600 transition-colors",children:"Buka Semua"}),(0,t.jsx)("button",{onClick:()=>{w(new Set)},className:"touch-target px-4 py-2 rounded-lg text-sm font-medium border border-surface-200 hover:bg-surface-100 text-surface-600 transition-colors",children:"Tutup Semua"}),(0,t.jsx)("div",{className:"ml-auto",children:(0,t.jsx)(k.default,{treeContainerRef:F,baniName:h||"Pohon-Nasab"})})]}),(0,t.jsx)("div",{ref:$,className:"overflow-auto rounded-2xl bg-white border border-surface-200 min-h-[60vh] p-8",children:(0,t.jsx)("div",{ref:F,children:(0,t.jsx)("div",{style:{transform:`scale(${E})`,transformOrigin:"top center"},className:"inline-flex justify-center w-full transition-transform duration-200",children:D?(0,t.jsx)(L,{node:D,level:0,expanded:N,toggleExpand:q,selectedId:A,onSelect:M,onQuickAdd:U}):(0,t.jsx)("div",{className:"text-center py-20",children:(0,t.jsx)("p",{className:"text-surface-500",children:"Belum ada anggota di pohon ini"})})})})}),O&&(0,t.jsx)("div",{className:"rounded-2xl bg-white border border-surface-200 p-6 animate-slide-up",children:(0,t.jsxs)("div",{className:"flex items-start gap-4",children:[(0,t.jsx)("div",{className:`w-16 h-16 rounded-full flex items-center justify-center ${"MALE"===O.gender?"bg-blue-100 text-blue-600":"bg-pink-100 text-pink-600"}`,children:(0,t.jsx)(o.User,{className:"w-8 h-8"})}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("h3",{className:"text-lg font-semibold text-surface-900",children:[O.fullName,!O.isAlive&&(0,t.jsx)("span",{className:"ml-2 text-sm font-normal text-surface-400",children:"(Almarhum/ah)"})]}),O.nickname&&(0,t.jsx)("p",{className:"text-sm text-surface-500",children:O.nickname}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-3 mt-3",children:[(0,t.jsxs)("span",{className:"text-xs px-2 py-1 rounded-lg bg-surface-100 text-surface-600",children:["Generasi ",O.generation+1]}),(0,t.jsx)("span",{className:`text-xs px-2 py-1 rounded-lg ${"MALE"===O.gender?"bg-blue-50 text-blue-700":"bg-pink-50 text-pink-700"}`,children:"MALE"===O.gender?"Laki-laki":"Perempuan"}),O.city&&(0,t.jsxs)("span",{className:"text-xs px-2 py-1 rounded-lg bg-surface-100 text-surface-600",children:["ðŸ“ ",O.city]})]}),O.phoneWhatsapp&&(0,t.jsxs)("a",{href:(0,v.getWhatsAppLink)(O.phoneWhatsapp),target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 mt-3 px-4 py-2 rounded-lg bg-green-500 text-white text-sm font-medium hover:bg-green-400 transition-colors",children:[(0,t.jsx)(d.Phone,{className:"w-4 h-4"}),"Chat WhatsApp"]}),(0,t.jsxs)(s.default,{href:`/dashboard/bani/${c}/members/${O.id}`,className:"inline-flex items-center gap-2 mt-3 ml-2 px-4 py-2 rounded-lg border border-primary-200 text-primary-600 text-sm font-medium hover:bg-primary-50 transition-colors",children:[(0,t.jsx)(x.ExternalLink,{className:"w-4 h-4"}),"Lihat Detail"]})]})]})})]}),T&&(0,t.jsx)(S,{context:T,allMembers:b,baniId:c,onClose:()=>H(null),onSuccess:R})]})}e.s(["default",()=>I],29278)},17571,e=>{e.v(t=>Promise.all(["static/chunks/b7de8d3b3d68c6c6.js"].map(t=>e.l(t))).then(()=>t(66459)))},34162,e=>{e.v(t=>Promise.all(["static/chunks/49f4928a87123cf4.js","static/chunks/e25680e07b77515b.js"].map(t=>e.l(t))).then(()=>t(55749)))}]);